"use strict";var MediasoupClient=(()=>{var y=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var lt=y((Oo,Br)=>{var Te=1e3,xe=Te*60,ke=xe*60,_e=ke*24,xi=_e*7,ki=_e*365.25;Br.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return Di(r);if(t==="number"&&isFinite(r))return e.long?Li(r):Pi(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function Di(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),s=(e[2]||"ms").toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return t*ki;case"weeks":case"week":case"w":return t*xi;case"days":case"day":case"d":return t*_e;case"hours":case"hour":case"hrs":case"hr":case"h":return t*ke;case"minutes":case"minute":case"mins":case"min":case"m":return t*xe;case"seconds":case"second":case"secs":case"sec":case"s":return t*Te;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function Pi(r){var e=Math.abs(r);return e>=_e?Math.round(r/_e)+"d":e>=ke?Math.round(r/ke)+"h":e>=xe?Math.round(r/xe)+"m":e>=Te?Math.round(r/Te)+"s":r+"ms"}function Li(r){var e=Math.abs(r);return e>=_e?pt(r,e,_e,"day"):e>=ke?pt(r,e,ke,"hour"):e>=xe?pt(r,e,xe,"minute"):e>=Te?pt(r,e,Te,"second"):r+" ms"}function pt(r,e,t,s){var i=e>=t*1.5;return Math.round(r/t)+" "+s+(i?"s":"")}});var Vr=y((jo,Ur)=>{function Ii(r){t.debug=t,t.default=t,t.coerce=p,t.disable=a,t.enable=i,t.enabled=c,t.humanize=lt(),t.destroy=l,Object.keys(r).forEach(o=>{t[o]=r[o]}),t.names=[],t.skips=[],t.formatters={};function e(o){let d=0;for(let u=0;u<o.length;u++)d=(d<<5)-d+o.charCodeAt(u),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(o){let d,u=null,f,g;function h(...m){if(!h.enabled)return;let _=h,R=Number(new Date),P=R-(d||R);_.diff=P,_.prev=d,_.curr=R,d=R,m[0]=t.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");let x=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,(D,re)=>{if(D==="%%")return"%";x++;let K=t.formatters[re];if(typeof K=="function"){let G=m[x];D=K.call(_,G),m.splice(x,1),x--}return D}),t.formatArgs.call(_,m),(_.log||t.log).apply(_,m)}return h.namespace=o,h.useColors=t.useColors(),h.color=t.selectColor(o),h.extend=s,h.destroy=t.destroy,Object.defineProperty(h,"enabled",{enumerable:!0,configurable:!1,get:()=>u!==null?u:(f!==t.namespaces&&(f=t.namespaces,g=t.enabled(o)),g),set:m=>{u=m}}),typeof t.init=="function"&&t.init(h),h}function s(o,d){let u=t(this.namespace+(typeof d>"u"?":":d)+o);return u.log=this.log,u}function i(o){t.save(o),t.namespaces=o,t.names=[],t.skips=[];let d=(typeof o=="string"?o:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let u of d)u[0]==="-"?t.skips.push(u.slice(1)):t.names.push(u)}function n(o,d){let u=0,f=0,g=-1,h=0;for(;u<o.length;)if(f<d.length&&(d[f]===o[u]||d[f]==="*"))d[f]==="*"?(g=f,h=u,f++):(u++,f++);else if(g!==-1)f=g+1,h++,u=h;else return!1;for(;f<d.length&&d[f]==="*";)f++;return f===d.length}function a(){let o=[...t.names,...t.skips.map(d=>"-"+d)].join(",");return t.enable(""),o}function c(o){for(let d of t.skips)if(n(o,d))return!1;for(let d of t.names)if(n(o,d))return!0;return!1}function p(o){return o instanceof Error?o.stack||o.message:o}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}Ur.exports=Ii});var Kt=y((z,ut)=>{z.formatArgs=Fi;z.save=Oi;z.load=ji;z.useColors=Mi;z.storage=Ni();z.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();z.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Mi(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let r;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(r=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(r[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Fi(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+ut.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,s=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(s=t))}),r.splice(s,0,e)}z.log=console.debug||console.log||(()=>{});function Oi(r){try{r?z.storage.setItem("debug",r):z.storage.removeItem("debug")}catch{}}function ji(){let r;try{r=z.storage.getItem("debug")||z.storage.getItem("DEBUG")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function Ni(){try{return localStorage}catch{}}ut.exports=Vr()(z);var{formatters:Ai}=ut.exports;Ai.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Gr=y(Hr=>{"use strict";Object.defineProperty(Hr,"__esModule",{value:!0})});var A=y(ht=>{"use strict";Object.defineProperty(ht,"__esModule",{value:!0});ht.Logger=void 0;var De=Kt(),Pe="mediasoup-client",Wt=class{_debug;_warn;_error;constructor(e){e?(this._debug=(0,De.default)(`${Pe}:${e}`),this._warn=(0,De.default)(`${Pe}:WARN:${e}`),this._error=(0,De.default)(`${Pe}:ERROR:${e}`)):(this._debug=(0,De.default)(Pe),this._warn=(0,De.default)(`${Pe}:WARN`),this._error=(0,De.default)(`${Pe}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};ht.Logger=Wt});var ss=y((qo,Jt)=>{"use strict";var Le=typeof Reflect=="object"?Reflect:null,Qr=Le&&typeof Le.apply=="function"?Le.apply:function(e,t,s){return Function.prototype.apply.call(e,t,s)},ft;Le&&typeof Le.ownKeys=="function"?ft=Le.ownKeys:Object.getOwnPropertySymbols?ft=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ft=function(e){return Object.getOwnPropertyNames(e)};function qi(r){console&&console.warn&&console.warn(r)}var Wr=Number.isNaN||function(e){return e!==e};function L(){L.init.call(this)}Jt.exports=L;Jt.exports.once=Ui;L.EventEmitter=L;L.prototype._events=void 0;L.prototype._eventsCount=0;L.prototype._maxListeners=void 0;var Kr=10;function mt(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(L,"defaultMaxListeners",{enumerable:!0,get:function(){return Kr},set:function(r){if(typeof r!="number"||r<0||Wr(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");Kr=r}});L.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};L.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Wr(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Jr(r){return r._maxListeners===void 0?L.defaultMaxListeners:r._maxListeners}L.prototype.getMaxListeners=function(){return Jr(this)};L.prototype.emit=function(e){for(var t=[],s=1;s<arguments.length;s++)t.push(arguments[s]);var i=e==="error",n=this._events;if(n!==void 0)i=i&&n.error===void 0;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var c=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw c.context=a,c}var p=n[e];if(p===void 0)return!1;if(typeof p=="function")Qr(p,this,t);else for(var l=p.length,o=ts(p,l),s=0;s<l;++s)Qr(o[s],this,t);return!0};function Zr(r,e,t,s){var i,n,a;if(mt(t),n=r._events,n===void 0?(n=r._events=Object.create(null),r._eventsCount=0):(n.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),n=r._events),a=n[e]),a===void 0)a=n[e]=t,++r._eventsCount;else if(typeof a=="function"?a=n[e]=s?[t,a]:[a,t]:s?a.unshift(t):a.push(t),i=Jr(r),i>0&&a.length>i&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=r,c.type=e,c.count=a.length,qi(c)}return r}L.prototype.addListener=function(e,t){return Zr(this,e,t,!1)};L.prototype.on=L.prototype.addListener;L.prototype.prependListener=function(e,t){return Zr(this,e,t,!0)};function zi(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Yr(r,e,t){var s={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},i=zi.bind(s);return i.listener=t,s.wrapFn=i,i}L.prototype.once=function(e,t){return mt(t),this.on(e,Yr(this,e,t)),this};L.prototype.prependOnceListener=function(e,t){return mt(t),this.prependListener(e,Yr(this,e,t)),this};L.prototype.removeListener=function(e,t){var s,i,n,a,c;if(mt(t),i=this._events,i===void 0)return this;if(s=i[e],s===void 0)return this;if(s===t||s.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,s.listener||t));else if(typeof s!="function"){for(n=-1,a=s.length-1;a>=0;a--)if(s[a]===t||s[a].listener===t){c=s[a].listener,n=a;break}if(n<0)return this;n===0?s.shift():$i(s,n),s.length===1&&(i[e]=s[0]),i.removeListener!==void 0&&this.emit("removeListener",e,c||t)}return this};L.prototype.off=L.prototype.removeListener;L.prototype.removeAllListeners=function(e){var t,s,i;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var n=Object.keys(s),a;for(i=0;i<n.length;++i)a=n[i],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=s[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function Xr(r,e,t){var s=r._events;if(s===void 0)return[];var i=s[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?Bi(i):ts(i,i.length)}L.prototype.listeners=function(e){return Xr(this,e,!0)};L.prototype.rawListeners=function(e){return Xr(this,e,!1)};L.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):es.call(r,e)};L.prototype.listenerCount=es;function es(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}L.prototype.eventNames=function(){return this._eventsCount>0?ft(this._events):[]};function ts(r,e){for(var t=new Array(e),s=0;s<e;++s)t[s]=r[s];return t}function $i(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function Bi(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function Ui(r,e){return new Promise(function(t,s){function i(a){r.removeListener(e,n),s(a)}function n(){typeof r.removeListener=="function"&&r.removeListener("error",i),t([].slice.call(arguments))}rs(r,e,n,{once:!0}),e!=="error"&&Vi(r,i,{once:!0})})}function Vi(r,e,t){typeof r.on=="function"&&rs(r,"error",e,t)}function rs(r,e,t,s){if(typeof r.on=="function")s.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function i(n){s.once&&r.removeEventListener(e,i),t(n)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}});var $=y(gt=>{"use strict";Object.defineProperty(gt,"__esModule",{value:!0});gt.EnhancedEventEmitter=void 0;var Hi=ss(),Gi=A(),Qi=new Gi.Logger("EnhancedEventEmitter"),Zt=class extends Hi.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}close(){super.removeAllListeners()}emit(e,...t){return super.emit(e,...t)}safeEmit(e,...t){try{return super.emit(e,...t)}catch(s){Qi.error("safeEmit() | event listener threw an error [eventName:%s]:%o",e,s);try{super.emit("listenererror",e,s)}catch{}return!!super.listenerCount(e)}}on(e,t){return super.on(e,t),this}off(e,t){return super.off(e,t),this}addListener(e,t){return super.on(e,t),this}prependListener(e,t){return super.prependListener(e,t),this}once(e,t){return super.once(e,t),this}prependOnceListener(e,t){return super.prependOnceListener(e,t),this}removeListener(e,t){return super.off(e,t),this}removeAllListeners(e){return super.removeAllListeners(e),this}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}rawListeners(e){return super.rawListeners(e)}};gt.EnhancedEventEmitter=Zt});var Q=y(Ie=>{"use strict";Object.defineProperty(Ie,"__esModule",{value:!0});Ie.InvalidStateError=Ie.UnsupportedError=void 0;var Yt=class r extends Error{constructor(e){super(e),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,r):this.stack=new Error(e).stack}};Ie.UnsupportedError=Yt;var Xt=class r extends Error{constructor(e){super(e),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,r):this.stack=new Error(e).stack}};Ie.InvalidStateError=Xt});var ve=y(We=>{"use strict";Object.defineProperty(We,"__esModule",{value:!0});We.clone=Ki;We.generateRandomNumber=Wi;We.deepFreeze=is;function Ki(r){if(r!==void 0)return Number.isNaN(r)?NaN:typeof structuredClone=="function"?structuredClone(r):JSON.parse(JSON.stringify(r))}function Wi(){return Math.round(Math.random()*1e7)}function is(r){let e=Reflect.ownKeys(r);for(let t of e){let s=r[t];(s&&typeof s=="object"||typeof s=="function")&&is(s)}return Object.freeze(r)}});var as=y((Uo,ns)=>{function Ji(r){t.debug=t,t.default=t,t.coerce=p,t.disable=a,t.enable=i,t.enabled=c,t.humanize=lt(),t.destroy=l,Object.keys(r).forEach(o=>{t[o]=r[o]}),t.names=[],t.skips=[],t.formatters={};function e(o){let d=0;for(let u=0;u<o.length;u++)d=(d<<5)-d+o.charCodeAt(u),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(o){let d,u=null,f,g;function h(...m){if(!h.enabled)return;let _=h,R=Number(new Date),P=R-(d||R);_.diff=P,_.prev=d,_.curr=R,d=R,m[0]=t.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");let x=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,(D,re)=>{if(D==="%%")return"%";x++;let K=t.formatters[re];if(typeof K=="function"){let G=m[x];D=K.call(_,G),m.splice(x,1),x--}return D}),t.formatArgs.call(_,m),(_.log||t.log).apply(_,m)}return h.namespace=o,h.useColors=t.useColors(),h.color=t.selectColor(o),h.extend=s,h.destroy=t.destroy,Object.defineProperty(h,"enabled",{enumerable:!0,configurable:!1,get:()=>u!==null?u:(f!==t.namespaces&&(f=t.namespaces,g=t.enabled(o)),g),set:m=>{u=m}}),typeof t.init=="function"&&t.init(h),h}function s(o,d){let u=t(this.namespace+(typeof d>"u"?":":d)+o);return u.log=this.log,u}function i(o){t.save(o),t.namespaces=o,t.names=[],t.skips=[];let d=(typeof o=="string"?o:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let u of d)u[0]==="-"?t.skips.push(u.slice(1)):t.names.push(u)}function n(o,d){let u=0,f=0,g=-1,h=0;for(;u<o.length;)if(f<d.length&&(d[f]===o[u]||d[f]==="*"))d[f]==="*"?(g=f,h=u,f++):(u++,f++);else if(g!==-1)f=g+1,h++,u=h;else return!1;for(;f<d.length&&d[f]==="*";)f++;return f===d.length}function a(){let o=[...t.names,...t.skips.map(d=>"-"+d)].join(",");return t.enable(""),o}function c(o){for(let d of t.skips)if(n(o,d))return!1;for(let d of t.names)if(n(o,d))return!0;return!1}function p(o){return o instanceof Error?o.stack||o.message:o}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}ns.exports=Ji});var os=y((B,_t)=>{B.formatArgs=Yi;B.save=Xi;B.load=en;B.useColors=Zi;B.storage=tn();B.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();B.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Zi(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let r;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(r=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(r[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Yi(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+_t.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,s=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(s=t))}),r.splice(s,0,e)}B.log=console.debug||console.log||(()=>{});function Xi(r){try{r?B.storage.setItem("debug",r):B.storage.removeItem("debug")}catch{}}function en(){let r;try{r=B.storage.getItem("debug")||B.storage.getItem("DEBUG")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function tn(){try{return localStorage}catch{}}_t.exports=as()(B);var{formatters:rn}=_t.exports;rn.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var cs=y(vt=>{"use strict";Object.defineProperty(vt,"__esModule",{value:!0});vt.Logger=void 0;var Me=os(),Fe="h264-profile-level-id",er=class{_debug;_warn;_error;constructor(e){e?(this._debug=(0,Me.default)(`${Fe}:${e}`),this._warn=(0,Me.default)(`${Fe}:WARN:${e}`),this._error=(0,Me.default)(`${Fe}:ERROR:${e}`)):(this._debug=(0,Me.default)(Fe),this._warn=(0,Me.default)(`${Fe}:WARN`),this._error=(0,Me.default)(`${Fe}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};vt.Logger=er});var fs=y(j=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0});j.ProfileLevelId=j.Level=j.Profile=void 0;j.parseProfileLevelId=us;j.profileLevelIdToString=hs;j.profileToString=on;j.levelToString=cn;j.parseSdpProfileLevelId=we;j.isSameProfile=dn;j.isSameProfileAndLevel=pn;j.generateProfileLevelIdStringForAnswer=ln;j.supportedLevel=un;var sn=cs(),Z=new sn.Logger,I;(function(r){r[r.ConstrainedBaseline=1]="ConstrainedBaseline",r[r.Baseline=2]="Baseline",r[r.Main=3]="Main",r[r.ConstrainedHigh=4]="ConstrainedHigh",r[r.High=5]="High",r[r.PredictiveHigh444=6]="PredictiveHigh444"})(I||(j.Profile=I={}));var v;(function(r){r[r.L1_b=0]="L1_b",r[r.L1=10]="L1",r[r.L1_1=11]="L1_1",r[r.L1_2=12]="L1_2",r[r.L1_3=13]="L1_3",r[r.L2=20]="L2",r[r.L2_1=21]="L2_1",r[r.L2_2=22]="L2_2",r[r.L3=30]="L3",r[r.L3_1=31]="L3_1",r[r.L3_2=32]="L3_2",r[r.L4=40]="L4",r[r.L4_1=41]="L4_1",r[r.L4_2=42]="L4_2",r[r.L5=50]="L5",r[r.L5_1=51]="L5_1",r[r.L5_2=52]="L5_2"})(v||(j.Level=v={}));var Oe=class{profile;level;constructor(e,t){this.profile=e,this.level=t}};j.ProfileLevelId=Oe;var nn=new Oe(I.ConstrainedBaseline,v.L3_1),W=class{mask;masked_value;constructor(e){this.mask=~ps("x",e),this.masked_value=ps("1",e)}isMatch(e){return this.masked_value===(e&this.mask)}},J=class{profile_idc;profile_iop;profile;constructor(e,t,s){this.profile_idc=e,this.profile_iop=t,this.profile=s}},an=[new J(66,new W("x1xx0000"),I.ConstrainedBaseline),new J(77,new W("1xxx0000"),I.ConstrainedBaseline),new J(88,new W("11xx0000"),I.ConstrainedBaseline),new J(66,new W("x0xx0000"),I.Baseline),new J(88,new W("10xx0000"),I.Baseline),new J(77,new W("0x0x0000"),I.Main),new J(100,new W("00000000"),I.High),new J(100,new W("00001100"),I.ConstrainedHigh),new J(244,new W("00000000"),I.PredictiveHigh444)],ds=[{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:v.L1},{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:v.L1_b},{max_macroblocks_per_second:3e3,max_macroblock_frame_size:396,level:v.L1_1},{max_macroblocks_per_second:6e3,max_macroblock_frame_size:396,level:v.L1_2},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:v.L1_3},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:v.L2},{max_macroblocks_per_second:19800,max_macroblock_frame_size:792,level:v.L2_1},{max_macroblocks_per_second:20250,max_macroblock_frame_size:1620,level:v.L2_2},{max_macroblocks_per_second:40500,max_macroblock_frame_size:1620,level:v.L3},{max_macroblocks_per_second:108e3,max_macroblock_frame_size:3600,level:v.L3_1},{max_macroblocks_per_second:216e3,max_macroblock_frame_size:5120,level:v.L3_2},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:v.L4},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:v.L4_1},{max_macroblocks_per_second:522240,max_macroblock_frame_size:8704,level:v.L4_2},{max_macroblocks_per_second:589824,max_macroblock_frame_size:22080,level:v.L5},{max_macroblocks_per_second:983040,max_macroblock_frame_size:36864,level:v.L5_1},{max_macroblocks_per_second:2073600,max_macroblock_frame_size:36864,level:v.L5_2}];function us(r){if(typeof r!="string"||r.length!==6)return;let t=parseInt(r,16);if(t===0)return;let s=t&255,i=t>>8&255,n=t>>16&255,a;switch(s){case v.L1_1:{a=(i&16)!==0?v.L1_b:v.L1_1;break}case v.L1:case v.L1_2:case v.L1_3:case v.L2:case v.L2_1:case v.L2_2:case v.L3:case v.L3_1:case v.L3_2:case v.L4:case v.L4_1:case v.L4_2:case v.L5:case v.L5_1:case v.L5_2:{a=s;break}default:{Z.warn(`parseProfileLevelId() | unrecognized level_idc [str:${r}, level_idc:${s}]`);return}}for(let c of an)if(n===c.profile_idc&&c.profile_iop.isMatch(i))return Z.debug(`parseProfileLevelId() | result [str:${r}, profile:${c.profile}, level:${a}]`),new Oe(c.profile,a);Z.warn(`parseProfileLevelId() | unrecognized profile_idc/profile_iop combination [str:${r}, profile_idc:${n}, profile_iop:${i}]`)}function hs(r){if(r.level==v.L1_b)switch(r.profile){case I.ConstrainedBaseline:return"42f00b";case I.Baseline:return"42100b";case I.Main:return"4d100b";default:{Z.warn(`profileLevelIdToString() | Level 1_b not is allowed for profile ${r.profile}`);return}}let e;switch(r.profile){case I.ConstrainedBaseline:{e="42e0";break}case I.Baseline:{e="4200";break}case I.Main:{e="4d00";break}case I.ConstrainedHigh:{e="640c";break}case I.High:{e="6400";break}case I.PredictiveHigh444:{e="f400";break}default:{Z.warn(`profileLevelIdToString() | unrecognized profile ${r.profile}`);return}}let t=r.level.toString(16);return t.length===1&&(t=`0${t}`),`${e}${t}`}function on(r){switch(r){case I.ConstrainedBaseline:return"ConstrainedBaseline";case I.Baseline:return"Baseline";case I.Main:return"Main";case I.ConstrainedHigh:return"ConstrainedHigh";case I.High:return"High";case I.PredictiveHigh444:return"PredictiveHigh444";default:{Z.warn(`profileToString() | unrecognized profile ${r}`);return}}}function cn(r){switch(r){case v.L1_b:return"1b";case v.L1:return"1";case v.L1_1:return"1.1";case v.L1_2:return"1.2";case v.L1_3:return"1.3";case v.L2:return"2";case v.L2_1:return"2.1";case v.L2_2:return"2.2";case v.L3:return"3";case v.L3_1:return"3.1";case v.L3_2:return"3.2";case v.L4:return"4";case v.L4_1:return"4.1";case v.L4_2:return"4.2";case v.L5:return"5";case v.L5_1:return"5.1";case v.L5_2:return"5.2";default:{Z.warn(`levelToString() | unrecognized level ${r}`);return}}}function we(r={}){let e=r["profile-level-id"];return e?us(e):nn}function dn(r={},e={}){let t=we(r),s=we(e);return!!(t&&s&&t.profile===s.profile)}function pn(r={},e={}){let t=we(r),s=we(e);return!!(t&&s&&t.profile===s.profile&&t.level==s.level)}function ln(r={},e={}){if(!r["profile-level-id"]&&!e["profile-level-id"]){Z.warn("generateProfileLevelIdStringForAnswer() | profile-level-id missing in local and remote params");return}let t=we(r),s=we(e);if(!t)throw new TypeError("invalid local_profile_level_id");if(!s)throw new TypeError("invalid remote_profile_level_id");if(t.profile!==s.profile)throw new TypeError("H264 Profile mismatch");let i=ls(r)&&ls(e),n=t.level,a=s.level,c=fn(n,a),p=i?n:c;return Z.debug(`generateProfileLevelIdStringForAnswer() | result [profile:${t.profile}, level:${p}]`),hs(new Oe(t.profile,p))}function un(r,e){for(let s=ds.length-1;s>=0;--s){let i=ds[s];if(i.max_macroblock_frame_size*256<=r&&i.max_macroblocks_per_second<=e*i.max_macroblock_frame_size)return Z.debug(`supportedLevel() | result [max_frame_pixel_count:${r}, max_fps:${e}, level:${i.level}]`),i.level}Z.warn(`supportedLevel() | no level supported [max_frame_pixel_count:${r}, max_fps:${e}]`)}function ps(r,e){return+(e[0]===r)<<7|+(e[1]===r)<<6|+(e[2]===r)<<5|+(e[3]===r)<<4|+(e[4]===r)<<3|+(e[5]===r)<<2|+(e[6]===r)<<1|+(e[7]===r)<<0}function hn(r,e){return r===v.L1_b?e!==v.L1&&e!==v.L1_b:e===v.L1_b?r!==v.L1:r<e}function fn(r,e){return hn(r,e)?r:e}function ls(r={}){let e=r["level-asymmetry-allowed"];return e===!0||e===1||e==="1"}});var se=y(U=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0});U.validateAndNormalizeRtpCapabilities=wn;U.validateAndNormalizeRtpParameters=rr;U.validateAndNormalizeSctpStreamParameters=bn;U.validateSctpCapabilities=yn;U.getExtendedRtpCapabilities=Cn;U.getRecvRtpCapabilities=Sn;U.getSendingRtpParameters=Rn;U.getSendingRemoteRtpParameters=En;U.reduceCodecs=Tn;U.generateProbatorRtpParameters=xn;U.canSend=kn;U.canReceive=Dn;var ms=fs(),mn=ve(),gn="probator",_n=1234,vn=127;function wn(r){if(typeof r!="object")throw new TypeError("caps is not an object");if(r.codecs&&!Array.isArray(r.codecs))throw new TypeError("caps.codecs is not an array");r.codecs||(r.codecs=[]);for(let e of r.codecs)Pn(e);if(r.headerExtensions&&!Array.isArray(r.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");r.headerExtensions||(r.headerExtensions=[]);for(let e of r.headerExtensions)Ln(e)}function rr(r){if(typeof r!="object")throw new TypeError("params is not an object");if(r.mid&&typeof r.mid!="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(r.codecs))throw new TypeError("missing params.codecs");for(let e of r.codecs)In(e);if(r.headerExtensions&&!Array.isArray(r.headerExtensions))throw new TypeError("params.headerExtensions is not an array");r.headerExtensions||(r.headerExtensions=[]);for(let e of r.headerExtensions)Mn(e);if(r.encodings&&!Array.isArray(r.encodings))throw new TypeError("params.encodings is not an array");r.encodings||(r.encodings=[]);for(let e of r.encodings)Fn(e);if(r.rtcp&&typeof r.rtcp!="object")throw new TypeError("params.rtcp is not an object");r.rtcp||(r.rtcp={}),On(r.rtcp)}function bn(r){if(typeof r!="object")throw new TypeError("params is not an object");if(typeof r.streamId!="number")throw new TypeError("missing params.streamId");let e=!1;if(typeof r.ordered=="boolean"?e=!0:r.ordered=!0,r.maxPacketLifeTime&&typeof r.maxPacketLifeTime!="number")throw new TypeError("invalid params.maxPacketLifeTime");if(r.maxRetransmits&&typeof r.maxRetransmits!="number")throw new TypeError("invalid params.maxRetransmits");if(r.maxPacketLifeTime&&r.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(e&&r.ordered&&(r.maxPacketLifeTime||r.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(!e&&(r.maxPacketLifeTime||r.maxRetransmits)&&(r.ordered=!1),r.label&&typeof r.label!="string")throw new TypeError("invalid params.label");if(r.protocol&&typeof r.protocol!="string")throw new TypeError("invalid params.protocol")}function yn(r){if(typeof r!="object")throw new TypeError("caps is not an object");if(!r.numStreams||typeof r.numStreams!="object")throw new TypeError("missing caps.numStreams");jn(r.numStreams)}function Cn(r,e,t){let s={codecs:[],headerExtensions:[]};if(t)for(let i of r.codecs??[]){if(je(i))continue;let n=(e.codecs??[]).find(c=>tr(c,i,{strict:!0,modify:!0}));if(!n)continue;let a={kind:i.kind,mimeType:i.mimeType,clockRate:i.clockRate,channels:i.channels,localPayloadType:i.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:n.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:i.parameters??{},remoteParameters:n.parameters??{},rtcpFeedback:gs(i,n)};s.codecs.push(a)}else for(let i of e.codecs??[]){if(je(i))continue;let n=(r.codecs??[]).find(c=>tr(c,i,{strict:!0,modify:!0}));if(!n)continue;let a={kind:n.kind,mimeType:n.mimeType,clockRate:n.clockRate,channels:n.channels,localPayloadType:n.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:i.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:n.parameters??{},remoteParameters:i.parameters??{},rtcpFeedback:gs(n,i)};s.codecs.push(a)}for(let i of s.codecs){let n=r.codecs.find(c=>je(c)&&c.parameters?.apt===i.localPayloadType),a=e.codecs.find(c=>je(c)&&c.parameters?.apt===i.remotePayloadType);n&&a&&(i.localRtxPayloadType=n.preferredPayloadType,i.remoteRtxPayloadType=a.preferredPayloadType)}for(let i of e.headerExtensions){let n=r.headerExtensions.find(c=>Nn(c,i));if(!n)continue;let a={kind:i.kind,uri:i.uri,sendId:n.preferredId,recvId:i.preferredId,encrypt:n.preferredEncrypt??!1,direction:"sendrecv"};switch(i.direction){case"sendrecv":{a.direction="sendrecv";break}case"recvonly":{a.direction="sendonly";break}case"sendonly":{a.direction="recvonly";break}case"inactive":{a.direction="inactive";break}}s.headerExtensions.push(a)}return s}function Sn(r){let e={codecs:[],headerExtensions:[]};for(let t of r.codecs){let s={kind:t.kind,mimeType:t.mimeType,preferredPayloadType:t.remotePayloadType,clockRate:t.clockRate,channels:t.channels,parameters:t.localParameters,rtcpFeedback:t.rtcpFeedback};if(e.codecs.push(s),!t.remoteRtxPayloadType)continue;let i={kind:t.kind,mimeType:`${t.kind}/rtx`,preferredPayloadType:t.remoteRtxPayloadType,clockRate:t.clockRate,parameters:{apt:t.remotePayloadType},rtcpFeedback:[]};e.codecs.push(i)}for(let t of r.headerExtensions){if(t.direction!=="sendrecv"&&t.direction!=="recvonly")continue;let s={kind:t.kind,uri:t.uri,preferredId:t.recvId,preferredEncrypt:t.encrypt??!1,direction:t.direction};e.headerExtensions.push(s)}return e}function Rn(r,e){let t={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(let s of e.codecs){if(s.kind!==r)continue;let i={mimeType:s.mimeType,payloadType:s.localPayloadType,clockRate:s.clockRate,channels:s.channels,parameters:s.localParameters,rtcpFeedback:s.rtcpFeedback};if(t.codecs.push(i),s.localRtxPayloadType){let n={mimeType:`${s.kind}/rtx`,payloadType:s.localRtxPayloadType,clockRate:s.clockRate,parameters:{apt:s.localPayloadType},rtcpFeedback:[]};t.codecs.push(n)}}for(let s of e.headerExtensions){if(s.kind&&s.kind!==r||s.direction!=="sendrecv"&&s.direction!=="sendonly")continue;let i={uri:s.uri,id:s.sendId,encrypt:s.encrypt,parameters:{}};t.headerExtensions.push(i)}return t}function En(r,e){let t={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(let s of e.codecs){if(s.kind!==r)continue;let i={mimeType:s.mimeType,payloadType:s.localPayloadType,clockRate:s.clockRate,channels:s.channels,parameters:s.remoteParameters,rtcpFeedback:s.rtcpFeedback};if(t.codecs.push(i),s.localRtxPayloadType){let n={mimeType:`${s.kind}/rtx`,payloadType:s.localRtxPayloadType,clockRate:s.clockRate,parameters:{apt:s.localPayloadType},rtcpFeedback:[]};t.codecs.push(n)}}for(let s of e.headerExtensions){if(s.kind&&s.kind!==r||s.direction!=="sendrecv"&&s.direction!=="sendonly")continue;let i={uri:s.uri,id:s.sendId,encrypt:s.encrypt,parameters:{}};t.headerExtensions.push(i)}if(t.headerExtensions.some(s=>s.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"))for(let s of t.codecs)s.rtcpFeedback=(s.rtcpFeedback??[]).filter(i=>i.type!=="goog-remb");else if(t.headerExtensions.some(s=>s.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"))for(let s of t.codecs)s.rtcpFeedback=(s.rtcpFeedback??[]).filter(i=>i.type!=="transport-cc");else for(let s of t.codecs)s.rtcpFeedback=(s.rtcpFeedback??[]).filter(i=>i.type!=="transport-cc"&&i.type!=="goog-remb");return t}function Tn(r,e){let t=[];if(!e)t.push(r[0]),je(r[1])&&t.push(r[1]);else{for(let s=0;s<r.length;++s)if(tr(r[s],e,{strict:!0})){t.push(r[s]),je(r[s+1])&&t.push(r[s+1]);break}if(t.length===0)throw new TypeError("no matching codec found")}return t}function xn(r){r=mn.clone(r),rr(r);let e={mid:gn,codecs:[],headerExtensions:[],encodings:[{ssrc:_n}],rtcp:{cname:"probator"}};return e.codecs.push(r.codecs[0]),e.codecs[0].payloadType=vn,e.headerExtensions=r.headerExtensions,e}function kn(r,e){return(e.codecs??[]).some(t=>t.kind===r)}function Dn(r,e){if(rr(r),r.codecs.length===0)return!1;let t=r.codecs[0];return(e.codecs??[]).some(s=>s.preferredPayloadType===t.payloadType)}function Pn(r){let e=new RegExp("^(audio|video)/(.+)","i");if(typeof r!="object")throw new TypeError("codec is not an object");if(!r.mimeType||typeof r.mimeType!="string")throw new TypeError("missing codec.mimeType");let t=e.exec(r.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");if(r.kind=t[1].toLowerCase(),typeof r.preferredPayloadType!="number")throw new TypeError("missing codec.preferredPayloadType");if(typeof r.clockRate!="number")throw new TypeError("missing codec.clockRate");r.kind==="audio"?typeof r.channels!="number"&&(r.channels=1):delete r.channels,(!r.parameters||typeof r.parameters!="object")&&(r.parameters={});for(let s of Object.keys(r.parameters)){let i=r.parameters[s];if(i===void 0&&(r.parameters[s]="",i=""),typeof i!="string"&&typeof i!="number")throw new TypeError(`invalid codec parameter [key:${s}s, value:${i}]`);if(s==="apt"&&typeof i!="number")throw new TypeError("invalid codec apt parameter")}(!r.rtcpFeedback||!Array.isArray(r.rtcpFeedback))&&(r.rtcpFeedback=[]);for(let s of r.rtcpFeedback)_s(s)}function _s(r){if(typeof r!="object")throw new TypeError("fb is not an object");if(!r.type||typeof r.type!="string")throw new TypeError("missing fb.type");(!r.parameter||typeof r.parameter!="string")&&(r.parameter="")}function Ln(r){if(typeof r!="object")throw new TypeError("ext is not an object");if(r.kind!=="audio"&&r.kind!=="video")throw new TypeError("invalid ext.kind");if(!r.uri||typeof r.uri!="string")throw new TypeError("missing ext.uri");if(typeof r.preferredId!="number")throw new TypeError("missing ext.preferredId");if(r.preferredEncrypt&&typeof r.preferredEncrypt!="boolean")throw new TypeError("invalid ext.preferredEncrypt");if(r.preferredEncrypt||(r.preferredEncrypt=!1),r.direction&&typeof r.direction!="string")throw new TypeError("invalid ext.direction");r.direction||(r.direction="sendrecv")}function In(r){let e=new RegExp("^(audio|video)/(.+)","i");if(typeof r!="object")throw new TypeError("codec is not an object");if(!r.mimeType||typeof r.mimeType!="string")throw new TypeError("missing codec.mimeType");let t=e.exec(r.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");if(typeof r.payloadType!="number")throw new TypeError("missing codec.payloadType");if(typeof r.clockRate!="number")throw new TypeError("missing codec.clockRate");t[1].toLowerCase()==="audio"?typeof r.channels!="number"&&(r.channels=1):delete r.channels,(!r.parameters||typeof r.parameters!="object")&&(r.parameters={});for(let i of Object.keys(r.parameters)){let n=r.parameters[i];if(n===void 0&&(r.parameters[i]="",n=""),typeof n!="string"&&typeof n!="number")throw new TypeError(`invalid codec parameter [key:${i}s, value:${n}]`);if(i==="apt"&&typeof n!="number")throw new TypeError("invalid codec apt parameter")}(!r.rtcpFeedback||!Array.isArray(r.rtcpFeedback))&&(r.rtcpFeedback=[]);for(let i of r.rtcpFeedback)_s(i)}function Mn(r){if(typeof r!="object")throw new TypeError("ext is not an object");if(!r.uri||typeof r.uri!="string")throw new TypeError("missing ext.uri");if(typeof r.id!="number")throw new TypeError("missing ext.id");if(r.encrypt&&typeof r.encrypt!="boolean")throw new TypeError("invalid ext.encrypt");r.encrypt||(r.encrypt=!1),(!r.parameters||typeof r.parameters!="object")&&(r.parameters={});for(let e of Object.keys(r.parameters)){let t=r.parameters[e];if(t===void 0&&(r.parameters[e]="",t=""),typeof t!="string"&&typeof t!="number")throw new TypeError("invalid header extension parameter")}}function Fn(r){if(typeof r!="object")throw new TypeError("encoding is not an object");if(r.ssrc&&typeof r.ssrc!="number")throw new TypeError("invalid encoding.ssrc");if(r.rid&&typeof r.rid!="string")throw new TypeError("invalid encoding.rid");if(r.rtx&&typeof r.rtx!="object")throw new TypeError("invalid encoding.rtx");if(r.rtx&&typeof r.rtx.ssrc!="number")throw new TypeError("missing encoding.rtx.ssrc");if((!r.dtx||typeof r.dtx!="boolean")&&(r.dtx=!1),r.scalabilityMode&&typeof r.scalabilityMode!="string")throw new TypeError("invalid encoding.scalabilityMode")}function On(r){if(typeof r!="object")throw new TypeError("rtcp is not an object");if(r.cname&&typeof r.cname!="string")throw new TypeError("invalid rtcp.cname");(!r.reducedSize||typeof r.reducedSize!="boolean")&&(r.reducedSize=!0)}function jn(r){if(typeof r!="object")throw new TypeError("numStreams is not an object");if(typeof r.OS!="number")throw new TypeError("missing numStreams.OS");if(typeof r.MIS!="number")throw new TypeError("missing numStreams.MIS")}function je(r){return r?/.+\/rtx$/i.test(r.mimeType):!1}function tr(r,e,{strict:t=!1,modify:s=!1}={}){let i=r.mimeType.toLowerCase(),n=e.mimeType.toLowerCase();if(i!==n||r.clockRate!==e.clockRate||r.channels!==e.channels)return!1;switch(i){case"video/h264":{if(t){let a=r.parameters["packetization-mode"]??0,c=e.parameters["packetization-mode"]??0;if(a!==c||!ms.isSameProfile(r.parameters,e.parameters))return!1;let p;try{p=ms.generateProfileLevelIdStringForAnswer(r.parameters,e.parameters)}catch{return!1}s&&(p?(r.parameters["profile-level-id"]=p,e.parameters["profile-level-id"]=p):(delete r.parameters["profile-level-id"],delete e.parameters["profile-level-id"]))}break}case"video/vp9":{if(t){let a=r.parameters["profile-id"]??0,c=e.parameters["profile-id"]??0;if(a!==c)return!1}break}}return!0}function Nn(r,e){return!(r.kind&&e.kind&&r.kind!==e.kind||r.uri!==e.uri)}function gs(r,e){let t=[];for(let s of r.rtcpFeedback??[]){let i=(e.rtcpFeedback??[]).find(n=>n.type===s.type&&(n.parameter===s.parameter||!n.parameter&&!s.parameter));i&&t.push(i)}return t}});var ws=y((Qo,vs)=>{function An(r){t.debug=t,t.default=t,t.coerce=p,t.disable=a,t.enable=i,t.enabled=c,t.humanize=lt(),t.destroy=l,Object.keys(r).forEach(o=>{t[o]=r[o]}),t.names=[],t.skips=[],t.formatters={};function e(o){let d=0;for(let u=0;u<o.length;u++)d=(d<<5)-d+o.charCodeAt(u),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(o){let d,u=null,f,g;function h(...m){if(!h.enabled)return;let _=h,R=Number(new Date),P=R-(d||R);_.diff=P,_.prev=d,_.curr=R,d=R,m[0]=t.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");let x=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,(D,re)=>{if(D==="%%")return"%";x++;let K=t.formatters[re];if(typeof K=="function"){let G=m[x];D=K.call(_,G),m.splice(x,1),x--}return D}),t.formatArgs.call(_,m),(_.log||t.log).apply(_,m)}return h.namespace=o,h.useColors=t.useColors(),h.color=t.selectColor(o),h.extend=s,h.destroy=t.destroy,Object.defineProperty(h,"enabled",{enumerable:!0,configurable:!1,get:()=>u!==null?u:(f!==t.namespaces&&(f=t.namespaces,g=t.enabled(o)),g),set:m=>{u=m}}),typeof t.init=="function"&&t.init(h),h}function s(o,d){let u=t(this.namespace+(typeof d>"u"?":":d)+o);return u.log=this.log,u}function i(o){t.save(o),t.namespaces=o,t.names=[],t.skips=[];let d=(typeof o=="string"?o:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let u of d)u[0]==="-"?t.skips.push(u.slice(1)):t.names.push(u)}function n(o,d){let u=0,f=0,g=-1,h=0;for(;u<o.length;)if(f<d.length&&(d[f]===o[u]||d[f]==="*"))d[f]==="*"?(g=f,h=u,f++):(u++,f++);else if(g!==-1)f=g+1,h++,u=h;else return!1;for(;f<d.length&&d[f]==="*";)f++;return f===d.length}function a(){let o=[...t.names,...t.skips.map(d=>"-"+d)].join(",");return t.enable(""),o}function c(o){for(let d of t.skips)if(n(o,d))return!1;for(let d of t.names)if(n(o,d))return!0;return!1}function p(o){return o instanceof Error?o.stack||o.message:o}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}vs.exports=An});var bs=y((V,wt)=>{V.formatArgs=zn;V.save=$n;V.load=Bn;V.useColors=qn;V.storage=Un();V.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();V.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function qn(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let r;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(r=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(r[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function zn(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+wt.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,s=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(s=t))}),r.splice(s,0,e)}V.log=console.debug||console.log||(()=>{});function $n(r){try{r?V.storage.setItem("debug",r):V.storage.removeItem("debug")}catch{}}function Bn(){let r;try{r=V.storage.getItem("debug")||V.storage.getItem("DEBUG")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function Un(){try{return localStorage}catch{}}wt.exports=ws()(V);var{formatters:Vn}=wt.exports;Vn.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var ys=y(bt=>{"use strict";Object.defineProperty(bt,"__esModule",{value:!0});bt.Logger=void 0;var Ne=bs(),Ae="awaitqueue",sr=class{_debug;_warn;_error;constructor(e){e?(this._debug=Ne(`${Ae}:${e}`),this._warn=Ne(`${Ae}:WARN:${e}`),this._error=Ne(`${Ae}:ERROR:${e}`)):(this._debug=Ne(Ae),this._warn=Ne(`${Ae}:WARN`),this._error=Ne(`${Ae}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};bt.Logger=sr});var ar=y(qe=>{"use strict";Object.defineProperty(qe,"__esModule",{value:!0});qe.AwaitQueueRemovedTaskError=qe.AwaitQueueStoppedError=void 0;var ir=class r extends Error{constructor(e){super(e??"queue stopped"),this.name="AwaitQueueStoppedError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,r)}};qe.AwaitQueueStoppedError=ir;var nr=class r extends Error{constructor(e){super(e??"queue task removed"),this.name="AwaitQueueRemovedTaskError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,r)}};qe.AwaitQueueRemovedTaskError=nr});var Cs=y(yt=>{"use strict";Object.defineProperty(yt,"__esModule",{value:!0});yt.AwaitQueue=void 0;var Hn=ys(),or=ar(),oe=new Hn.Logger("AwaitQueue"),cr=class{pendingTasks=new Map;nextTaskId=0;constructor(){oe.debug("constructor()")}get size(){return this.pendingTasks.size}async push(e,t,s){if(t=t??e.name,oe.debug(`push() [name:${t}, options:%o]`,s),typeof e!="function")throw new TypeError("given task is not a function");if(t)try{Object.defineProperty(e,"name",{value:t})}catch{}return new Promise((i,n)=>{if(t&&s?.removeOngoingTasksWithSameName)for(let c of this.pendingTasks.values())c.name===t&&c.reject(new or.AwaitQueueRemovedTaskError,{canExecuteNextTask:!1});let a={id:this.nextTaskId++,task:e,name:t,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:c=>{if(a.completed)return;a.completed=!0,this.pendingTasks.delete(a.id),oe.debug(`resolving task [name:${a.name}]`),i(c);let[p]=this.pendingTasks.values();p&&!p.executedAt&&this.execute(p)},reject:(c,{canExecuteNextTask:p})=>{if(!a.completed&&(a.completed=!0,this.pendingTasks.delete(a.id),oe.debug(`rejecting task [name:${a.name}]: %s`,String(c)),n(c),p)){let[l]=this.pendingTasks.values();l&&!l.executedAt&&this.execute(l)}}};this.pendingTasks.set(a.id,a),this.pendingTasks.size===1&&this.execute(a)})}stop(){oe.debug("stop()");for(let e of this.pendingTasks.values())oe.debug(`stop() | stopping task [name:${e.name}]`),e.reject(new or.AwaitQueueStoppedError,{canExecuteNextTask:!1})}remove(e){oe.debug(`remove() [taskIdx:${e}]`);let t=Array.from(this.pendingTasks.values())[e];if(!t){oe.debug(`stop() | no task with given idx [taskIdx:${e}]`);return}t.reject(new or.AwaitQueueRemovedTaskError,{canExecuteNextTask:!0})}dump(){let e=Date.now(),t=0;return Array.from(this.pendingTasks.values()).map(s=>({idx:t++,task:s.task,name:s.name,enqueuedTime:s.executedAt?s.executedAt-s.enqueuedAt:e-s.enqueuedAt,executionTime:s.executedAt?e-s.executedAt:0}))}async execute(e){if(oe.debug(`execute() [name:${e.name}]`),e.executedAt)throw new Error("task already being executed");e.executedAt=Date.now();try{let t=await e.task();e.resolve(t)}catch(t){e.reject(t,{canExecuteNextTask:!0})}}};yt.AwaitQueue=cr});var Rs=y(he=>{"use strict";Object.defineProperty(he,"__esModule",{value:!0});he.AwaitQueueRemovedTaskError=he.AwaitQueueStoppedError=he.AwaitQueue=void 0;var Gn=Cs();Object.defineProperty(he,"AwaitQueue",{enumerable:!0,get:function(){return Gn.AwaitQueue}});var Ss=ar();Object.defineProperty(he,"AwaitQueueStoppedError",{enumerable:!0,get:function(){return Ss.AwaitQueueStoppedError}});Object.defineProperty(he,"AwaitQueueRemovedTaskError",{enumerable:!0,get:function(){return Ss.AwaitQueueRemovedTaskError}})});var Ts=y(Ct=>{"use strict";Object.defineProperty(Ct,"__esModule",{value:!0});Ct.Producer=void 0;var Qn=A(),Es=$(),ze=Q(),ie=new Qn.Logger("Producer"),dr=class extends Es.EnhancedEventEmitter{_id;_localId;_closed=!1;_rtpSender;_track;_kind;_rtpParameters;_paused;_maxSpatialLayer;_stopTracks;_disableTrackOnPause;_zeroRtpOnPause;_appData;_observer=new Es.EnhancedEventEmitter;constructor({id:e,localId:t,rtpSender:s,track:i,rtpParameters:n,stopTracks:a,disableTrackOnPause:c,zeroRtpOnPause:p,appData:l}){super(),ie.debug("constructor()"),this._id=e,this._localId=t,this._rtpSender=s,this._track=i,this._kind=i.kind,this._rtpParameters=n,this._paused=c?!i.enabled:!1,this._maxSpatialLayer=void 0,this._stopTracks=a,this._disableTrackOnPause=c,this._zeroRtpOnPause=p,this._appData=l??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(ie.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(ie.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new ze.InvalidStateError("closed");return new Promise((e,t)=>{this.safeEmit("@getstats",e,t)})}pause(){if(ie.debug("pause()"),this._closed){ie.error("pause() | Producer closed");return}this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((e,t)=>{this.safeEmit("@pause",e,t)}).catch(()=>{}),this._observer.safeEmit("pause")}resume(){if(ie.debug("resume()"),this._closed){ie.error("resume() | Producer closed");return}this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((e,t)=>{this.safeEmit("@resume",e,t)}).catch(()=>{}),this._observer.safeEmit("resume")}async replaceTrack({track:e}){if(ie.debug("replaceTrack() [track:%o]",e),this._closed){if(e&&this._stopTracks)try{e.stop()}catch{}throw new ze.InvalidStateError("closed")}else if(e?.readyState==="ended")throw new ze.InvalidStateError("track ended");if(e===this._track){ie.debug("replaceTrack() | same track, ignored");return}await new Promise((t,s)=>{this.safeEmit("@replacetrack",e,t,s)}),this.destroyTrack(),this._track=e,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()}async setMaxSpatialLayer(e){if(this._closed)throw new ze.InvalidStateError("closed");if(this._kind!=="video")throw new ze.UnsupportedError("not a video Producer");if(typeof e!="number")throw new TypeError("invalid spatialLayer");e!==this._maxSpatialLayer&&(await new Promise((t,s)=>{this.safeEmit("@setmaxspatiallayer",e,t,s)}).catch(()=>{}),this._maxSpatialLayer=e)}async setRtpEncodingParameters(e){if(this._closed)throw new ze.InvalidStateError("closed");if(typeof e!="object")throw new TypeError("invalid params");await new Promise((t,s)=>{this.safeEmit("@setrtpencodingparameters",e,t,s)})}onTrackEnded(){ie.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch{}}};Ct.Producer=dr});var ks=y(St=>{"use strict";Object.defineProperty(St,"__esModule",{value:!0});St.Consumer=void 0;var Kn=A(),xs=$(),Wn=Q(),ne=new Kn.Logger("Consumer"),pr=class extends xs.EnhancedEventEmitter{_id;_localId;_producerId;_closed=!1;_rtpReceiver;_track;_rtpParameters;_paused;_appData;_observer=new xs.EnhancedEventEmitter;constructor({id:e,localId:t,producerId:s,rtpReceiver:i,track:n,rtpParameters:a,appData:c}){super(),ne.debug("constructor()"),this._id=e,this._localId=t,this._producerId=s,this._rtpReceiver=i,this._track=n,this._rtpParameters=a,this._paused=!n.enabled,this._appData=c??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(ne.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(ne.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new Wn.InvalidStateError("closed");return new Promise((e,t)=>{this.safeEmit("@getstats",e,t)})}pause(){if(ne.debug("pause()"),this._closed){ne.error("pause() | Consumer closed");return}if(this._paused){ne.debug("pause() | Consumer is already paused");return}this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause")}resume(){if(ne.debug("resume()"),this._closed){ne.error("resume() | Consumer closed");return}if(!this._paused){ne.debug("resume() | Consumer is already resumed");return}this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")}onTrackEnded(){ne.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch{}}};St.Consumer=pr});var Ps=y(Rt=>{"use strict";Object.defineProperty(Rt,"__esModule",{value:!0});Rt.DataProducer=void 0;var Jn=A(),Ds=$(),Zn=Q(),ce=new Jn.Logger("DataProducer"),lr=class extends Ds.EnhancedEventEmitter{_id;_dataChannel;_closed=!1;_sctpStreamParameters;_appData;_observer=new Ds.EnhancedEventEmitter;constructor({id:e,dataChannel:t,sctpStreamParameters:s,appData:i}){super(),ce.debug("constructor()"),this._id=e,this._dataChannel=t,this._sctpStreamParameters=s,this._appData=i??{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dataChannel.bufferedAmountLowThreshold=e}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(ce.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(ce.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(e){if(ce.debug("send()"),this._closed)throw new Zn.InvalidStateError("closed");this._dataChannel.send(e)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(ce.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let t=e.error??new Error("unknown DataChannel error");e.error?.errorDetail==="sctp-failure"?ce.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",e.error?.sctpCauseCode,e.error.message):ce.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)}),this._dataChannel.addEventListener("close",()=>{this._closed||(ce.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||ce.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}};Rt.DataProducer=lr});var Is=y(Et=>{"use strict";Object.defineProperty(Et,"__esModule",{value:!0});Et.DataConsumer=void 0;var Yn=A(),Ls=$(),be=new Yn.Logger("DataConsumer"),ur=class extends Ls.EnhancedEventEmitter{_id;_dataProducerId;_dataChannel;_closed=!1;_sctpStreamParameters;_appData;_observer=new Ls.EnhancedEventEmitter;constructor({id:e,dataProducerId:t,dataChannel:s,sctpStreamParameters:i,appData:n}){super(),be.debug("constructor()"),this._id=e,this._dataProducerId=t,this._dataChannel=s,this._sctpStreamParameters=i,this._appData=n??{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(e){this._dataChannel.binaryType=e}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(be.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(be.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(be.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let t=e.error??new Error("unknown DataChannel error");e.error?.errorDetail==="sctp-failure"?be.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",e.error?.sctpCauseCode,e.error.message):be.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)}),this._dataChannel.addEventListener("close",()=>{this._closed||(be.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",e=>{this._closed||this.safeEmit("message",e.data)})}};Et.DataConsumer=ur});var Fs=y(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.Transport=void 0;var Xn=Rs(),ea=A(),Ms=$(),O=Q(),hr=ve(),Je=se(),ta=Ts(),ra=ks(),sa=Ps(),ia=Is(),F=new ea.Logger("Transport"),fr=class{consumerOptions;promise;resolve;reject;constructor(e){this.consumerOptions=e,this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}},mr=class extends Ms.EnhancedEventEmitter{_id;_closed=!1;_direction;_getSendExtendedRtpCapabilities;_recvRtpCapabilities;_canProduceByKind;_maxSctpMessageSize;_handler;_iceGatheringState="new";_connectionState="new";_appData;_producers=new Map;_consumers=new Map;_dataProducers=new Map;_dataConsumers=new Map;_probatorConsumerCreated=!1;_awaitQueue=new Xn.AwaitQueue;_pendingConsumerTasks=[];_consumerCreationInProgress=!1;_pendingPauseConsumers=new Map;_consumerPauseInProgress=!1;_pendingResumeConsumers=new Map;_consumerResumeInProgress=!1;_pendingCloseConsumers=new Map;_consumerCloseInProgress=!1;_observer=new Ms.EnhancedEventEmitter;constructor({direction:e,id:t,iceParameters:s,iceCandidates:i,dtlsParameters:n,sctpParameters:a,iceServers:c,iceTransportPolicy:p,additionalSettings:l,appData:o,handlerFactory:d,getSendExtendedRtpCapabilities:u,recvRtpCapabilities:f,canProduceByKind:g}){super(),F.debug("constructor() [id:%s, direction:%s]",t,e),this._id=t,this._direction=e,this._getSendExtendedRtpCapabilities=u,this._recvRtpCapabilities=f,this._canProduceByKind=g,this._maxSctpMessageSize=a?a.maxMessageSize:null;let h=hr.clone(l)??{};delete h.iceServers,delete h.iceTransportPolicy,delete h.bundlePolicy,delete h.rtcpMuxPolicy,this._handler=d.factory({direction:e,iceParameters:s,iceCandidates:i,dtlsParameters:n,sctpParameters:a,iceServers:c,iceTransportPolicy:p,additionalSettings:h,getSendExtendedRtpCapabilities:this._getSendExtendedRtpCapabilities}),this._appData=o??{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get iceGatheringState(){return this._iceGatheringState}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){if(!this._closed){F.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._connectionState="closed";for(let e of this._producers.values())e.transportClosed();this._producers.clear();for(let e of this._consumers.values())e.transportClosed();this._consumers.clear();for(let e of this._dataProducers.values())e.transportClosed();this._dataProducers.clear();for(let e of this._dataConsumers.values())e.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close"),super.close(),this._observer.close()}}async getStats(){if(this._closed)throw new O.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:e}){if(F.debug("restartIce()"),this._closed)throw new O.InvalidStateError("closed");if(!e)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>await this._handler.restartIce(e),"transport.restartIce()")}async updateIceServers({iceServers:e}={}){if(F.debug("updateIceServers()"),this._closed)throw new O.InvalidStateError("closed");if(!Array.isArray(e))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(e),"transport.updateIceServers()")}async produce({track:e,streamId:t,encodings:s,codecOptions:i,headerExtensionOptions:n,codec:a,stopTracks:c=!0,disableTrackOnPause:p=!0,zeroRtpOnPause:l=!1,onRtpSender:o,appData:d={}}={}){if(F.debug("produce() [track:%o]",e),this._closed)throw new O.InvalidStateError("closed");if(e){if(this._direction!=="send")throw new O.UnsupportedError("not a sending Transport");if(this._canProduceByKind[e.kind]){if(e.readyState==="ended")throw new O.InvalidStateError("track ended");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');if(d&&typeof d!="object")throw new TypeError("if given, appData must be an object")}else throw new O.UnsupportedError(`cannot produce ${e.kind}`)}else throw new TypeError("missing track");return this._awaitQueue.push(async()=>{let u;if(s&&!Array.isArray(s))throw TypeError("encodings must be an array");s?.length===0?u=void 0:s&&(u=s.map(m=>{let _={active:!0};return m.active===!1&&(_.active=!1),typeof m.dtx=="boolean"&&(_.dtx=m.dtx),typeof m.scalabilityMode=="string"&&(_.scalabilityMode=m.scalabilityMode),typeof m.scaleResolutionDownBy=="number"&&(_.scaleResolutionDownBy=m.scaleResolutionDownBy),typeof m.maxBitrate=="number"&&(_.maxBitrate=m.maxBitrate),typeof m.maxFramerate=="number"&&(_.maxFramerate=m.maxFramerate),typeof m.adaptivePtime=="boolean"&&(_.adaptivePtime=m.adaptivePtime),typeof m.priority=="string"&&(_.priority=m.priority),typeof m.networkPriority=="string"&&(_.networkPriority=m.networkPriority),_}));let{localId:f,rtpParameters:g,rtpSender:h}=await this._handler.send({track:e,streamId:t,encodings:u,codecOptions:i,headerExtensionOptions:n,codec:a,onRtpSender:o});try{Je.validateAndNormalizeRtpParameters(g);let{id:m}=await new Promise((R,P)=>{this.safeEmit("produce",{kind:e.kind,rtpParameters:g,appData:d},R,P)}),_=new ta.Producer({id:m,localId:f,rtpSender:h,track:e,rtpParameters:g,stopTracks:c,disableTrackOnPause:p,zeroRtpOnPause:l,appData:d});return this._producers.set(_.id,_),this.handleProducer(_),this._observer.safeEmit("newproducer",_),_}catch(m){throw this._handler.stopSending(f).catch(()=>{}),m}},"transport.produce()").catch(u=>{if(c)try{e.stop()}catch{}throw u})}async consume({id:e,producerId:t,kind:s,rtpParameters:i,streamId:n,onRtpReceiver:a,appData:c={}}){if(F.debug("consume()"),this._closed)throw new O.InvalidStateError("closed");if(this._direction!=="recv")throw new O.UnsupportedError("not a receiving Transport");if(typeof e!="string")throw new TypeError("missing id");if(typeof t!="string")throw new TypeError("missing producerId");if(s!=="audio"&&s!=="video")throw new TypeError(`invalid kind '${s}'`);if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(c&&typeof c!="object")throw new TypeError("if given, appData must be an object");let p=hr.clone(i);if(!Je.canReceive(p,this._recvRtpCapabilities))throw new O.UnsupportedError("cannot consume this Producer");let o=new fr({id:e,producerId:t,kind:s,rtpParameters:p,streamId:n,onRtpReceiver:a,appData:c});return this._pendingConsumerTasks.push(o),queueMicrotask(()=>{this._closed||this._consumerCreationInProgress===!1&&this.createPendingConsumers()}),o.promise}async produceData({ordered:e=!0,maxPacketLifeTime:t,maxRetransmits:s,label:i="",protocol:n="",appData:a={}}={}){if(F.debug("produceData()"),this._closed)throw new O.InvalidStateError("closed");if(this._direction!=="send")throw new O.UnsupportedError("not a sending Transport");if(this._maxSctpMessageSize){if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');if(a&&typeof a!="object")throw new TypeError("if given, appData must be an object")}else throw new O.UnsupportedError("SCTP not enabled by remote Transport");return(t||s)&&(e=!1),this._awaitQueue.push(async()=>{let{dataChannel:c,sctpStreamParameters:p}=await this._handler.sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:i,protocol:n});Je.validateAndNormalizeSctpStreamParameters(p);let{id:l}=await new Promise((d,u)=>{this.safeEmit("producedata",{sctpStreamParameters:p,label:i,protocol:n,appData:a},d,u)}),o=new sa.DataProducer({id:l,dataChannel:c,sctpStreamParameters:p,appData:a});return this._dataProducers.set(o.id,o),this.handleDataProducer(o),this._observer.safeEmit("newdataproducer",o),o},"transport.produceData()")}async consumeData({id:e,dataProducerId:t,sctpStreamParameters:s,label:i="",protocol:n="",appData:a={}}){if(F.debug("consumeData()"),this._closed)throw new O.InvalidStateError("closed");if(this._direction!=="recv")throw new O.UnsupportedError("not a receiving Transport");if(this._maxSctpMessageSize){if(typeof e!="string")throw new TypeError("missing id");if(typeof t!="string")throw new TypeError("missing dataProducerId");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(a&&typeof a!="object")throw new TypeError("if given, appData must be an object")}else throw new O.UnsupportedError("SCTP not enabled by remote Transport");let c=hr.clone(s);return Je.validateAndNormalizeSctpStreamParameters(c),this._awaitQueue.push(async()=>{let{dataChannel:p}=await this._handler.receiveDataChannel({sctpStreamParameters:c,label:i,protocol:n}),l=new ia.DataConsumer({id:e,dataProducerId:t,dataChannel:p,sctpStreamParameters:c,appData:a});return this._dataConsumers.set(l.id,l),this.handleDataConsumer(l),this._observer.safeEmit("newdataconsumer",l),l},"transport.consumeData()")}createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingConsumerTasks.length===0){F.debug("createPendingConsumers() | there is no Consumer to be created");return}let e=[...this._pendingConsumerTasks];this._pendingConsumerTasks=[];let t,s=[];for(let i of e){let{id:n,kind:a,rtpParameters:c,streamId:p,onRtpReceiver:l}=i.consumerOptions;s.push({trackId:n,kind:a,rtpParameters:c,streamId:p,onRtpReceiver:l})}try{let i=await this._handler.receive(s);for(let n=0;n<i.length;++n){let a=e[n],c=i[n],{id:p,producerId:l,kind:o,rtpParameters:d,appData:u}=a.consumerOptions,{localId:f,rtpReceiver:g,track:h}=c,m=new ra.Consumer({id:p,localId:f,producerId:l,rtpReceiver:g,track:h,rtpParameters:d,appData:u});this._consumers.set(m.id,m),this.handleConsumer(m),!this._probatorConsumerCreated&&!t&&o==="video"&&(t=m),this._observer.safeEmit("newconsumer",m),a.resolve(m)}}catch(i){for(let n of e)n.reject(i)}if(t)try{let i=Je.generateProbatorRtpParameters(t.rtpParameters);await this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:i}]),F.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(i){F.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",i)}},"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingPauseConsumers.size===0){F.debug("pausePendingConsumers() | there is no Consumer to be paused");return}let e=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{let t=e.map(s=>s.localId);await this._handler.pauseReceiving(t)}catch(t){F.error("pausePendingConsumers() | failed to pause Consumers:",t)}},"transport.pausePendingConsumers()").then(()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingResumeConsumers.size===0){F.debug("resumePendingConsumers() | there is no Consumer to be resumed");return}let e=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{let t=e.map(s=>s.localId);await this._handler.resumeReceiving(t)}catch(t){F.error("resumePendingConsumers() | failed to resume Consumers:",t)}},"transport.resumePendingConsumers()").then(()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingCloseConsumers.size===0){F.debug("closePendingConsumers() | there is no Consumer to be closed");return}let e=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{await this._handler.stopReceiving(e.map(t=>t.localId))}catch(t){F.error("closePendingConsumers() | failed to close Consumers:",t)}},"transport.closePendingConsumers()").then(()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){let e=this._handler;e.on("@connect",({dtlsParameters:t},s,i)=>{if(this._closed){i(new O.InvalidStateError("closed"));return}this.safeEmit("connect",{dtlsParameters:t},s,i)}),e.on("@icegatheringstatechange",t=>{t!==this._iceGatheringState&&(F.debug("ICE gathering state changed to %s",t),this._iceGatheringState=t,this._closed||this.safeEmit("icegatheringstatechange",t))}),e.on("@icecandidateerror",t=>{F.warn(`ICE candidate error [url:${t.url}, localAddress:${t.address}, localPort:${t.port}]: ${t.errorCode} "${t.errorText}"`),this.safeEmit("icecandidateerror",t)}),e.on("@connectionstatechange",t=>{t!==this._connectionState&&(F.debug("connection state changed to %s",t),this._connectionState=t,this._closed||this.safeEmit("connectionstatechange",t))})}handleProducer(e){e.on("@close",()=>{this._producers.delete(e.id),!this._closed&&this._awaitQueue.push(async()=>await this._handler.stopSending(e.localId),"producer @close event").catch(t=>F.warn("producer.close() failed:%o",t))}),e.on("@pause",(t,s)=>{this._awaitQueue.push(async()=>await this._handler.pauseSending(e.localId),"producer @pause event").then(t).catch(s)}),e.on("@resume",(t,s)=>{this._awaitQueue.push(async()=>await this._handler.resumeSending(e.localId),"producer @resume event").then(t).catch(s)}),e.on("@replacetrack",(t,s,i)=>{this._awaitQueue.push(async()=>await this._handler.replaceTrack(e.localId,t),"producer @replacetrack event").then(s).catch(i)}),e.on("@setmaxspatiallayer",(t,s,i)=>{this._awaitQueue.push(async()=>await this._handler.setMaxSpatialLayer(e.localId,t),"producer @setmaxspatiallayer event").then(s).catch(i)}),e.on("@setrtpencodingparameters",(t,s,i)=>{this._awaitQueue.push(async()=>await this._handler.setRtpEncodingParameters(e.localId,t),"producer @setrtpencodingparameters event").then(s).catch(i)}),e.on("@getstats",(t,s)=>{if(this._closed)return s(new O.InvalidStateError("closed"));this._handler.getSenderStats(e.localId).then(t).catch(s)})}handleConsumer(e){e.on("@close",()=>{this._consumers.delete(e.id),this._pendingPauseConsumers.delete(e.id),this._pendingResumeConsumers.delete(e.id),!this._closed&&(this._pendingCloseConsumers.set(e.id,e),this._consumerCloseInProgress===!1&&this.closePendingConsumers())}),e.on("@pause",()=>{this._pendingResumeConsumers.has(e.id)&&this._pendingResumeConsumers.delete(e.id),this._pendingPauseConsumers.set(e.id,e),queueMicrotask(()=>{this._closed||this._consumerPauseInProgress===!1&&this.pausePendingConsumers()})}),e.on("@resume",()=>{this._pendingPauseConsumers.has(e.id)&&this._pendingPauseConsumers.delete(e.id),this._pendingResumeConsumers.set(e.id,e),queueMicrotask(()=>{this._closed||this._consumerResumeInProgress===!1&&this.resumePendingConsumers()})}),e.on("@getstats",(t,s)=>{if(this._closed)return s(new O.InvalidStateError("closed"));this._handler.getReceiverStats(e.localId).then(t).catch(s)})}handleDataProducer(e){e.on("@close",()=>{this._dataProducers.delete(e.id)})}handleDataConsumer(e){e.on("@close",()=>{this._dataConsumers.delete(e.id)})}};Tt.Transport=mr});var xt=y((sc,js)=>{var Os=js.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(r){return r.encoding?"rtpmap:%d %s/%s/%s":r.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(r){return r.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(r){return r.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(r){return"extmap:%d"+(r.direction?"/%s":"%v")+(r["encrypt-uri"]?" %s":"%v")+" %s"+(r.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(r){return r.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{push:"msid",reg:/^msid:([\w-]+)(?: ([\w-]+))?/,names:["id","appdata"],format:"msid:%s %s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(r){var e="candidate:%s %d %s %d %s %d typ %s";return e+=r.raddr!=null?" raddr %s rport %d":"%v%v",e+=r.tcptype!=null?" tcptype %s":"%v",r.generation!=null&&(e+=" generation %d"),e+=r["network-id"]!=null?" network-id %d":"%v",e+=r["network-cost"]!=null?" network-cost %d":"%v",e}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(r){var e="ssrc:%d";return r.attribute!=null&&(e+=" %s",r.value!=null&&(e+=":%s")),e}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(r){return r.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(r){return r.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(r){return"imageattr:%s %s %s"+(r.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(r){return"simulcast:%s %s"+(r.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(r){return"ts-refclk:%s"+(r.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(r){var e="mediaclk:";return e+=r.id!=null?"id=%s %s":"%v%s",e+=r.mediaClockValue!=null?"=%s":"",e+=r.rateNumerator!=null?" rate=%s":"",e+=r.rateDenominator!=null?"/%s":"",e}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(Os).forEach(function(r){var e=Os[r];e.forEach(function(t){t.reg||(t.reg=/(.*)/),t.format||(t.format="%s")})})});var qs=y(de=>{var $e=function(r){return String(Number(r))===r?Number(r):r},na=function(r,e,t,s){if(s&&!t)e[s]=$e(r[1]);else for(var i=0;i<t.length;i+=1)r[i+1]!=null&&(e[t[i]]=$e(r[i+1]))},aa=function(r,e,t){var s=r.name&&r.names;r.push&&!e[r.push]?e[r.push]=[]:s&&!e[r.name]&&(e[r.name]={});var i=r.push?{}:s?e[r.name]:e;na(t.match(r.reg),i,r.names,r.name),r.push&&e[r.push].push(i)},Ns=xt(),oa=RegExp.prototype.test.bind(/^([a-z])=(.*)/);de.parse=function(r){var e={},t=[],s=e;return r.split(/(\r\n|\r|\n)/).filter(oa).forEach(function(i){var n=i[0],a=i.slice(2);n==="m"&&(t.push({rtp:[],fmtp:[]}),s=t[t.length-1]);for(var c=0;c<(Ns[n]||[]).length;c+=1){var p=Ns[n][c];if(p.reg.test(a))return aa(p,s,a)}}),e.media=t,e};var As=function(r,e){var t=e.split(/=(.+)/,2);return t.length===2?r[t[0]]=$e(t[1]):t.length===1&&e.length>1&&(r[t[0]]=void 0),r};de.parseParams=function(r){return r.split(/;\s?/).reduce(As,{})};de.parseFmtpConfig=de.parseParams;de.parsePayloads=function(r){return r.toString().split(" ").map(Number)};de.parseRemoteCandidates=function(r){for(var e=[],t=r.split(" ").map($e),s=0;s<t.length;s+=3)e.push({component:t[s],ip:t[s+1],port:t[s+2]});return e};de.parseImageAttributes=function(r){return r.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(As,{})})};de.parseSimulcastStreamList=function(r){return r.split(";").map(function(e){return e.split(",").map(function(t){var s,i=!1;return t[0]!=="~"?s=$e(t):(s=$e(t.substring(1,t.length)),i=!0),{scid:s,paused:i}})})}});var $s=y((nc,zs)=>{var gr=xt(),ca=/%[sdv%]/g,da=function(r){var e=1,t=arguments,s=t.length;return r.replace(ca,function(i){if(e>=s)return i;var n=t[e];switch(e+=1,i){case"%%":return"%";case"%s":return String(n);case"%d":return Number(n);case"%v":return""}})},Ze=function(r,e,t){var s=e.format instanceof Function?e.format(e.push?t:t[e.name]):e.format,i=[r+"="+s];if(e.names)for(var n=0;n<e.names.length;n+=1){var a=e.names[n];e.name?i.push(t[e.name][a]):i.push(t[e.names[n]])}else i.push(t[e.name]);return da.apply(null,i)},pa=["v","o","s","i","u","e","p","c","b","t","r","z","a"],la=["i","c","b","a"];zs.exports=function(r,e){e=e||{},r.version==null&&(r.version=0),r.name==null&&(r.name=" "),r.media.forEach(function(n){n.payloads==null&&(n.payloads="")});var t=e.outerOrder||pa,s=e.innerOrder||la,i=[];return t.forEach(function(n){gr[n].forEach(function(a){a.name in r&&r[a.name]!=null?i.push(Ze(n,a,r)):a.push in r&&r[a.push]!=null&&r[a.push].forEach(function(c){i.push(Ze(n,a,c))})})}),r.media.forEach(function(n){i.push(Ze("m",gr.m[0],n)),s.forEach(function(a){gr[a].forEach(function(c){c.name in n&&n[c.name]!=null?i.push(Ze(a,c,n)):c.push in n&&n[c.push]!=null&&n[c.push].forEach(function(p){i.push(Ze(a,c,p))})})})}),i.join(`\r
`)+`\r
`}});var pe=y(ae=>{var ye=qs(),ua=$s(),ha=xt();ae.grammar=ha;ae.write=ua;ae.parse=ye.parse;ae.parseParams=ye.parseParams;ae.parseFmtpConfig=ye.parseFmtpConfig;ae.parsePayloads=ye.parsePayloads;ae.parseRemoteCandidates=ye.parseRemoteCandidates;ae.parseImageAttributes=ye.parseImageAttributes;ae.parseSimulcastStreamList=ye.parseSimulcastStreamList});var Ce=y(_r=>{"use strict";Object.defineProperty(_r,"__esModule",{value:!0});_r.parse=ma;var fa=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function ma(r){let e=fa.exec(r??"");return e?{spatialLayers:Number(e[1]),temporalLayers:Number(e[2])}:{spatialLayers:1,temporalLayers:1}}});var Vs=y(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.OfferMediaSection=fe.AnswerMediaSection=fe.MediaSection=void 0;var ga=pe(),Bs=ve(),Ye=class{_mediaObject;constructor({iceParameters:e,iceCandidates:t,dtlsParameters:s}){if(this._mediaObject={type:"",port:0,protocol:"",payloads:"",rtp:[],fmtp:[]},e&&this.setIceParameters(e),t){this._mediaObject.candidates=[];for(let i of t){let n={foundation:i.foundation,component:1,ip:i.address??i.ip,port:i.port,priority:i.priority,transport:i.protocol,type:i.type};i.tcpType&&(n.tcptype=i.tcpType),this._mediaObject.candidates.push(n)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}s&&this.setDtlsRole(s.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause()}close(){this.disable(),this._mediaObject.port=0,delete this._mediaObject.candidates,delete this._mediaObject.endOfCandidates,delete this._mediaObject.iceUfrag,delete this._mediaObject.icePwd,delete this._mediaObject.iceOptions,this._mediaObject.rtp=[],this._mediaObject.fmtp=[],delete this._mediaObject.rtcp,delete this._mediaObject.rtcpFb,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}};fe.MediaSection=Ye;var vr=class extends Ye{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:s,sctpParameters:i,plainRtpParameters:n,offerMediaObject:a,offerRtpParameters:c,answerRtpParameters:p,codecOptions:l}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:s}),this._mediaObject.mid=String(a.mid),this._mediaObject.type=a.type,this._mediaObject.protocol=a.protocol,n?(this._mediaObject.connection={ip:n.ip,version:n.ipVersion},this._mediaObject.port=n.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),a.type){case"audio":case"video":{this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(let o of p.codecs){let d={payload:o.payloadType,codec:Us(o),rate:o.clockRate};o.channels>1&&(d.encoding=o.channels),this._mediaObject.rtp.push(d);let u=Bs.clone(o.parameters)??{},f=Bs.clone(o.rtcpFeedback)??[];if(l){let{opusStereo:h,opusFec:m,opusDtx:_,opusMaxPlaybackRate:R,opusMaxAverageBitrate:P,opusPtime:x,opusNack:k,videoGoogleStartBitrate:D,videoGoogleMaxBitrate:re,videoGoogleMinBitrate:K}=l,G=c.codecs.find(ge=>ge.payloadType===o.payloadType);switch(o.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":{h!==void 0&&(G.parameters["sprop-stereo"]=h?1:0,u.stereo=h?1:0),m!==void 0&&(G.parameters.useinbandfec=m?1:0,u.useinbandfec=m?1:0),_!==void 0&&(G.parameters.usedtx=_?1:0,u.usedtx=_?1:0),R!==void 0&&(u.maxplaybackrate=R),P!==void 0&&(u.maxaveragebitrate=P),x!==void 0&&(G.parameters.ptime=x,u.ptime=x),k||(G.rtcpFeedback=G.rtcpFeedback.filter(ge=>ge.type!=="nack"||ge.parameter),f=f.filter(ge=>ge.type!=="nack"||ge.parameter));break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":case"video/av1":{D!==void 0&&(u["x-google-start-bitrate"]=D),re!==void 0&&(u["x-google-max-bitrate"]=re),K!==void 0&&(u["x-google-min-bitrate"]=K);break}}}let g={payload:o.payloadType,config:""};for(let h of Object.keys(u))g.config&&(g.config+=";"),g.config+=`${h}=${u[h]}`;g.config&&this._mediaObject.fmtp.push(g);for(let h of f)this._mediaObject.rtcpFb.push({payload:o.payloadType,type:h.type,subtype:h.parameter})}this._mediaObject.payloads=p.codecs.map(o=>o.payloadType).join(" "),this._mediaObject.ext=[];for(let o of p.headerExtensions)(a.ext??[]).some(u=>u.uri===o.uri)&&this._mediaObject.ext.push({uri:o.uri,value:o.id});if(a.extmapAllowMixed==="extmap-allow-mixed"&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),a.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:a.simulcast.list1},this._mediaObject.rids=[];for(let o of a.rids??[])o.direction==="send"&&this._mediaObject.rids.push({id:o.id,direction:"recv"})}else if(a.simulcast_03){this._mediaObject.simulcast_03={value:a.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(let o of a.rids??[])o.direction==="send"&&this._mediaObject.rids.push({id:o.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";break}case"application":{typeof a.sctpPort=="number"?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=i.port,this._mediaObject.maxMessageSize=i.maxMessageSize):a.sctpmap&&(this._mediaObject.payloads=String(i.port),this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:i.port,maxMessageSize:i.maxMessageSize});break}}}setDtlsRole(e){switch(e){case"client":{this._mediaObject.setup="active";break}case"server":{this._mediaObject.setup="passive";break}case"auto":{this._mediaObject.setup="actpass";break}}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(e){if(!this._mediaObject.simulcast?.list1)return;let t={};for(let n of e)n.rid&&(t[n.rid]=n);let s=this._mediaObject.simulcast.list1,i=ga.parseSimulcastStreamList(s);for(let n of i)for(let a of n)a.paused=!t[a.scid]?.active;this._mediaObject.simulcast.list1=i.map(n=>n.map(a=>`${a.paused?"~":""}${a.scid}`).join(",")).join(";")}};fe.AnswerMediaSection=vr;var wr=class extends Ye{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:s,sctpParameters:i,plainRtpParameters:n,mid:a,kind:c,offerRtpParameters:p,streamId:l,trackId:o}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:s}),this._mediaObject.mid=String(a),this._mediaObject.type=c,n?(this._mediaObject.connection={ip:n.ip,version:n.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=n.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},i?this._mediaObject.protocol="UDP/DTLS/SCTP":this._mediaObject.protocol="UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),this._mediaObject.extmapAllowMixed="extmap-allow-mixed",c){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._mediaObject.msid=[{id:l,appdata:o}];for(let g of p.codecs){let h={payload:g.payloadType,codec:Us(g),rate:g.clockRate};g.channels>1&&(h.encoding=g.channels),this._mediaObject.rtp.push(h);let m={payload:g.payloadType,config:""};for(let _ of Object.keys(g.parameters??{}))m.config&&(m.config+=";"),m.config+=`${_}=${g.parameters[_]}`;m.config&&this._mediaObject.fmtp.push(m);for(let _ of g.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:g.payloadType,type:_.type,subtype:_.parameter})}this._mediaObject.payloads=p.codecs.map(g=>g.payloadType).join(" "),this._mediaObject.ext=[];for(let g of p.headerExtensions)this._mediaObject.ext.push({uri:g.uri,value:g.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";let d=p.encodings[0],u=d.ssrc,f=d.rtx?.ssrc;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],u&&p.rtcp.cname&&this._mediaObject.ssrcs.push({id:u,attribute:"cname",value:p.rtcp.cname}),f&&(p.rtcp.cname&&this._mediaObject.ssrcs.push({id:f,attribute:"cname",value:p.rtcp.cname}),u&&this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${u} ${f}`}));break}case"application":{this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=i.port,this._mediaObject.maxMessageSize=i.maxMessageSize;break}}}setDtlsRole(e){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}};fe.OfferMediaSection=wr;function Us(r){let t=new RegExp("^(audio|video)/(.+)","i").exec(r.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");return t[2]}});var Be=y(Pt=>{"use strict";Object.defineProperty(Pt,"__esModule",{value:!0});Pt.RemoteSdp=void 0;var _a=pe(),va=A(),kt=Vs(),wa=["av1","h264"],Dt=new va.Logger("RemoteSdp"),br=class{_iceParameters;_iceCandidates;_dtlsParameters;_sctpParameters;_plainRtpParameters;_mediaSections=[];_midToIndex=new Map;_firstMid;_sdpObject;constructor({iceParameters:e,iceCandidates:t,dtlsParameters:s,sctpParameters:i,plainRtpParameters:n}){if(this._iceParameters=e,this._iceCandidates=t,this._dtlsParameters=s,this._sctpParameters=i,this._plainRtpParameters=n,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:"10000",sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},this._sdpObject.iceOptions="ice2",e?.iceLite&&(this._sdpObject.icelite="ice-lite"),s){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};let a=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:s.fingerprints[a-1].algorithm,hash:s.fingerprints[a-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}n&&(this._sdpObject.origin.address=n.ip,this._sdpObject.origin.ipVer=n.ipVersion)}updateIceParameters(e){Dt.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;for(let t of this._mediaSections)t.setIceParameters(e)}updateDtlsRole(e){Dt.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;for(let t of this._mediaSections)t.setDtlsRole(e)}setSessionExtmapAllowMixed(){Dt.debug("setSessionExtmapAllowMixed()"),this._sdpObject.extmapAllowMixed="extmap-allow-mixed"}getNextMediaSectionIdx(){for(let e=0;e<this._mediaSections.length;++e){let t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:e,reuseMid:t,offerRtpParameters:s,answerRtpParameters:i,codecOptions:n}){let a=new kt.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e,offerRtpParameters:s,answerRtpParameters:i,codecOptions:n}),c=a.getObject();c.rtp.find(l=>wa.includes(l.codec.toLowerCase()))||(c.ext=c.ext?.filter(l=>l.uri!=="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension")),t?this.replaceMediaSection(a,t):this._midToIndex.has(a.mid)?this.replaceMediaSection(a):this.addMediaSection(a)}receive({mid:e,kind:t,offerRtpParameters:s,streamId:i,trackId:n}){this.setSessionExtmapAllowMixed();let a=new kt.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,mid:e,kind:t,offerRtpParameters:s,streamId:i,trackId:n}),c=this._mediaSections.find(p=>p.closed);c?this.replaceMediaSection(a,c.mid):this.addMediaSection(a)}pauseMediaSection(e){this.findMediaSection(e).pause()}resumeSendingMediaSection(e){this.findMediaSection(e).resume()}resumeReceivingMediaSection(e){this.findMediaSection(e).resume()}disableMediaSection(e){this.findMediaSection(e).disable()}closeMediaSection(e){let t=this.findMediaSection(e);return e===this._firstMid?(Dt.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),this.disableMediaSection(e),!1):(t.close(),this.regenerateBundleMids(),!0)}muxMediaSectionSimulcast(e,t){let s=this.findMediaSection(e);s.muxSimulcastStreams(t),this.replaceMediaSection(s)}sendSctpAssociation({offerMediaObject:e}){let t=new kt.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this.addMediaSection(t)}receiveSctpAssociation(){let e=new kt.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application"});this.addMediaSection(e)}getSdp(){return this._sdpObject.origin.sessionVersion++,_a.write(this._sdpObject)}addMediaSection(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this.regenerateBundleMids()}replaceMediaSection(e,t){if(typeof t=="string"){let s=this._midToIndex.get(t);if(s===void 0)throw new Error(`no media section found for reuseMid '${t}'`);let i=this._mediaSections[s];this._mediaSections[s]=e,this._midToIndex.delete(i.mid),this._midToIndex.set(e.mid,s),this._sdpObject.media[s]=e.getObject(),this.regenerateBundleMids()}else{let s=this._midToIndex.get(e.mid);if(s===void 0)throw new Error(`no media section found with mid '${e.mid}'`);this._mediaSections[s]=e,this._sdpObject.media[s]=e.getObject()}}findMediaSection(e){let t=this._midToIndex.get(e);if(t===void 0)throw new Error(`no media section found with mid '${e}'`);return this._mediaSections[t]}regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(e=>!e.closed).map(e=>e.mid).join(" "))}};Pt.RemoteSdp=br});var Ue=y(Se=>{"use strict";Object.defineProperty(Se,"__esModule",{value:!0});Se.extractRtpCapabilities=ba;Se.extractDtlsParameters=ya;Se.getCname=Ca;Se.applyCodecParameters=Sa;Se.addHeaderExtension=Ra;var Hs=pe();function ba({sdpObject:r}){let e=new Map,t=new Map;for(let i of r.media){let n=i.type;switch(n){case"audio":case"video":break;default:continue}for(let a of i.rtp){let c={kind:n,mimeType:`${n}/${a.codec}`,preferredPayloadType:a.payload,clockRate:a.rate,channels:a.encoding,parameters:{},rtcpFeedback:[]};e.set(c.preferredPayloadType,c)}for(let a of i.fmtp??[]){let c=Hs.parseParams(a.config),p=e.get(a.payload);p&&(c?.hasOwnProperty("profile-level-id")&&(c["profile-level-id"]=String(c["profile-level-id"])),p.parameters=c)}for(let a of i.rtcpFb??[]){let c={type:a.type,parameter:a.subtype};if(c.parameter||delete c.parameter,a.payload!=="*"){let p=e.get(Number(a.payload));if(!p)continue;p.rtcpFeedback.push(c)}else for(let p of e.values())p.kind===n&&!/.+\/rtx$/i.test(p.mimeType)&&p.rtcpFeedback.push(c)}for(let a of i.ext??[]){if(a["encrypt-uri"])continue;let c={kind:n,uri:a.uri,preferredId:a.value};t.set(c.preferredId,c)}}return{codecs:Array.from(e.values()),headerExtensions:Array.from(t.values())}}function ya({sdpObject:r}){let e=r.setup,t=r.fingerprint;if(!e||!t){let n=(r.media??[]).find(a=>a.port!==0);n&&(e=e??n.setup,t=t??n.fingerprint)}if(e){if(!t)throw new Error("no a=fingerprint found at SDP session or media level")}else throw new Error("no a=setup found at SDP session or media level");let s;switch(e){case"active":{s="client";break}case"passive":{s="server";break}case"actpass":{s="auto";break}}return{role:s,fingerprints:[{algorithm:t.type,value:t.hash}]}}function Ca({offerMediaObject:r}){let e=(r.ssrcs??[]).find(t=>t.attribute==="cname");return e?e.value:""}function Sa({offerRtpParameters:r,answerMediaObject:e}){for(let t of r.codecs){let s=t.mimeType.toLowerCase();if(s!=="audio/opus"||!(e.rtp??[]).find(c=>c.payload===t.payloadType))continue;e.fmtp=e.fmtp??[];let n=e.fmtp.find(c=>c.payload===t.payloadType);n||(n={payload:t.payloadType,config:""},e.fmtp.push(n));let a=Hs.parseParams(n.config);if(s==="audio/opus"){let c=t.parameters?.["sprop-stereo"];c!==void 0&&(a.stereo=Number(c)?1:0)}n.config="";for(let c of Object.keys(a))n.config&&(n.config+=";"),n.config+=`${c}=${a[c]}`}}function Ra({offerMediaObject:r,headerExtensionUri:e,headerExtensionId:t}){r.ext||(r.ext=[]),r.ext.push({uri:e,value:t})}});var Ve=y(Lt=>{"use strict";Object.defineProperty(Lt,"__esModule",{value:!0});Lt.getRtpEncodings=Ea;Lt.addLegacySimulcast=Ta;function Ea({offerMediaObject:r}){let e=new Set;for(let i of r.ssrcs??[]){let n=i.id;n&&e.add(n)}if(e.size===0)throw new Error("no a=ssrc lines found");let t=new Map;for(let i of r.ssrcGroups??[]){if(i.semantics!=="FID")continue;let n=i.ssrcs.split(/\s+/),a=Number(n[0]),c=Number(n[1]);e.has(a)&&(e.delete(a),e.delete(c),t.set(a,c))}for(let i of e)t.set(i,void 0);let s=[];for(let[i,n]of t){let a={ssrc:i};n&&(a.rtx={ssrc:n}),s.push(a)}return s}function Ta({offerMediaObject:r,numStreams:e}){if(e<=1)throw new TypeError("numStreams must be greater than 1");let t=(r.ssrcs??[]).find(d=>d.attribute==="msid");if(!t)throw new Error("a=ssrc line with msid information not found");let[s,i]=t.value.split(" "),n=Number(t.id),a;(r.ssrcGroups??[]).some(d=>{if(d.semantics!=="FID")return!1;let u=d.ssrcs.split(/\s+/);return Number(u[0])===n?(a=Number(u[1]),!0):!1});let c=(r.ssrcs??[]).find(d=>d.attribute==="cname");if(!c)throw new Error("a=ssrc line with cname information not found");let p=c.value,l=[],o=[];for(let d=0;d<e;++d)l.push(n+d),a&&o.push(a+d);r.ssrcGroups=[],r.ssrcs=[],r.ssrcGroups.push({semantics:"SIM",ssrcs:l.join(" ")});for(let d of l)r.ssrcs.push({id:d,attribute:"cname",value:p}),r.ssrcs.push({id:d,attribute:"msid",value:`${s} ${i}`});for(let d=0;d<o.length;++d){let u=l[d],f=o[d];r.ssrcs.push({id:f,attribute:"cname",value:p}),r.ssrcs.push({id:f,attribute:"msid",value:`${s} ${i}`}),r.ssrcGroups.push({semantics:"FID",ssrcs:`${u} ${f}`})}}});var He=y(Xe=>{"use strict";Object.defineProperty(Xe,"__esModule",{value:!0});Xe.addNackSupportForOpus=xa;Xe.addHeaderExtensionSupport=ka;Xe.getMsidStreamIdAndTrackId=Da;function xa(r){for(let e of r.codecs??[])(e.mimeType.toLowerCase()==="audio/opus"||e.mimeType.toLowerCase()==="audio/multiopus")&&!e.rtcpFeedback?.some(t=>t.type==="nack"&&!t.parameter)&&(e.rtcpFeedback||(e.rtcpFeedback=[]),e.rtcpFeedback.push({type:"nack"}))}function ka(r,e){let t,s=r.headerExtensions?.find(n=>n.uri===e.uri);if(s){if(s.kind===e.kind)return;t=s.preferredId}if(r.headerExtensions||(r.headerExtensions=[]),t===void 0){t=1;let n=new Set(r.headerExtensions.map(a=>a.preferredId));for(;n.has(t);)++t}let i={kind:e.kind,uri:e.uri,preferredId:t,preferredEncrypt:!1,direction:e.direction};r.headerExtensions.push(i)}function Da(r){if(!r||typeof r!="string")return{msidStreamId:void 0,msidTrackId:void 0};let[e,t]=r.trim().split(/\s+/);return e?{msidStreamId:e,msidTrackId:t}:{msidStreamId:void 0,msidTrackId:void 0}}});var Ws=y(It=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});It.Chrome111=void 0;var le=pe(),Pa=$(),La=A(),et=se(),Ia=Q(),Ma=Ce(),Fa=Be(),tt=Ue(),Gs=Ve(),yr=He(),E=new La.Logger("Chrome111"),Qs="Chrome111",Ks={OS:1024,MIS:1024},Cr=class r extends Pa.EnhancedEventEmitter{_closed=!1;_direction;_remoteSdp;_getSendExtendedRtpCapabilities;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return{name:Qs,factory:e=>new r(e),getNativeRtpCapabilities:async()=>{E.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video",{sendEncodings:[{scalabilityMode:"L3T3"}]});let t=await e.createOffer();try{e.close()}catch{}e=void 0;let s=le.parse(t.sdp);return r.getLocalRtpCapabilities(s)}catch(t){try{e?.close()}catch{}throw e=void 0,t}},getNativeSctpCapabilities:async()=>(E.debug("getNativeSctpCapabilities()"),{numStreams:Ks})}}static getLocalRtpCapabilities(e,t=[]){let s=tt.extractRtpCapabilities({sdpObject:e});et.validateAndNormalizeRtpCapabilities(s),yr.addNackSupportForOpus(s);for(let i of t)yr.addHeaderExtensionSupport(s,i);return s}constructor({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:n,iceServers:a,iceTransportPolicy:c,additionalSettings:p,getSendExtendedRtpCapabilities:l}){super(),E.debug("constructor()"),this._direction=e,this._remoteSdp=new Fa.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:n}),this._getSendExtendedRtpCapabilities=l,i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a??[],iceTransportPolicy:c??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...p}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(E.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}get name(){return Qs}close(){if(E.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(e){this.assertNotClosed(),E.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),E.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});E.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let s={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();E.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,streamId:t,encodings:s,codecOptions:i,headerExtensionOptions:n,codec:a,onRtpSender:c}){if(this.assertNotClosed(),this.assertSendDirection(),E.debug("send() [kind:%s, track.id:%s, streamId:%s]",e.kind,e.id,t),s&&s.length>1){let x=1;for(let k of s){let D=k.scalabilityMode?(0,Ma.parse)(k.scalabilityMode).temporalLayers:3;D>x&&(x=D)}s.forEach((k,D)=>{k.rid=`r${D}`,k.scalabilityMode=`L1T${x}`})}let p=this._remoteSdp.getNextMediaSectionIdx(),l=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:s});c&&c(l.sender);let o=await this._pc.createOffer(),d=le.parse(o.sdp);d.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let u=[];u.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:e.kind,direction:"sendonly"});let f=r.getLocalRtpCapabilities(d,u),g=this._getSendExtendedRtpCapabilities(f),h=et.getSendingRtpParameters(e.kind,g);h.codecs=et.reduceCodecs(h.codecs,a);let m=et.getSendingRemoteRtpParameters(e.kind,g);if(m.codecs=et.reduceCodecs(m.codecs,a),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),n?.absCaptureTime){let x=d.media[p.idx];tt.addHeaderExtension({offerMediaObject:x,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:m.headerExtensions.find(k=>k.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),o={type:"offer",sdp:le.write(d)}}E.debug("send() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);let _=l.mid;h.mid=_,d=le.parse(this._pc.localDescription.sdp);let R=d.media[p.idx];if(h.rtcp.cname=tt.getCname({offerMediaObject:R}),h.msid=`${t??this._sendStream.id} ${e.id}`,!s)h.encodings=Gs.getRtpEncodings({offerMediaObject:R});else if(s.length===1){let x=Gs.getRtpEncodings({offerMediaObject:R});Object.assign(x[0],s[0]),h.encodings=x}else h.encodings=s;this._remoteSdp.send({offerMediaObject:R,reuseMid:p.reuseMid,offerRtpParameters:h,answerRtpParameters:m,codecOptions:i});let P={type:"answer",sdp:this._remoteSdp.getSdp()};return E.debug("send() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P),this._mapMidTransceiver.set(_,l),{localId:_,rtpParameters:h,rtpSender:l.sender}}async stopSending(e){if(this.assertSendDirection(),E.debug("stopSending() [localId:%s]",e),this._closed)return;let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}let i=await this._pc.createOffer();E.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);let n={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),E.debug("pauseSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);let s=await this._pc.createOffer();E.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),E.debug("resumeSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";let s=await this._pc.createOffer();E.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?E.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):E.debug("replaceTrack() [localId:%s, no track]",e);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");await s.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),E.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");let i=s.sender.getParameters();i.encodings.forEach((c,p)=>{p<=t?c.active=!0:c.active=!1}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let n=await this._pc.createOffer();E.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);let a={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),E.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");let i=s.sender.getParameters();i.encodings.forEach((c,p)=>{i.encodings[p]={...c,...t}}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let n=await this._pc.createOffer();E.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);let a={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:i,protocol:n}){this.assertNotClosed(),this.assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,protocol:n};E.debug("sendDataChannel() [options:%o]",a);let c=this._pc.createDataChannel(i,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Ks.MIS,!this._hasDataChannelMediaSection){let l=await this._pc.createOffer(),o=le.parse(l.sdp),d=o.media.find(f=>f.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),E.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:d});let u={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u),this._hasDataChannelMediaSection=!0}let p={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:c,sctpStreamParameters:p}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();let t=[],s=new Map;for(let c of e){let{trackId:p,kind:l,rtpParameters:o,streamId:d}=c;E.debug("receive() [trackId:%s, kind:%s]",p,l);let u=o.mid??String(this._mapMidTransceiver.size);s.set(p,u);let{msidStreamId:f}=yr.getMsidStreamIdAndTrackId(o.msid);this._remoteSdp.receive({mid:u,kind:l,offerRtpParameters:o,streamId:d??f??o.rtcp?.cname??"-",trackId:p})}let i={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);for(let c of e){let{trackId:p,onRtpReceiver:l}=c;if(l){let o=s.get(p),d=this._pc.getTransceivers().find(u=>u.mid===o);if(!d)throw new Error("transceiver not found");l(d.receiver)}}let n=await this._pc.createAnswer(),a=le.parse(n.sdp);for(let c of e){let{trackId:p,rtpParameters:l}=c,o=s.get(p),d=a.media.find(u=>String(u.mid)===o);tt.applyCodecParameters({offerRtpParameters:l,answerMediaObject:d})}n={type:"answer",sdp:le.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),E.debug("receive() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(let c of e){let{trackId:p}=c,l=s.get(p),o=this._pc.getTransceivers().find(d=>d.mid===l);if(o)this._mapMidTransceiver.set(l,o),t.push({localId:l,track:o.receiver.track,rtpReceiver:o.receiver});else throw new Error("new RTCRtpTransceiver not found")}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(let i of e){E.debug("stopReceiving() [localId:%s]",i);let n=this._mapMidTransceiver.get(i);if(!n)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(n.mid)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();E.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(let i of e)this._mapMidTransceiver.delete(i)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(let i of e){E.debug("pauseReceiving() [localId:%s]",i);let n=this._mapMidTransceiver.get(i);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="inactive",this._remoteSdp.pauseMediaSection(i)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();E.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(let i of e){E.debug("resumeReceiving() [localId:%s]",i);let n=this._mapMidTransceiver.get(i);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();E.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertNotClosed(),this.assertRecvDirection();let{streamId:i,ordered:n,maxPacketLifeTime:a,maxRetransmits:c}=e,p={negotiated:!0,id:i,ordered:n,maxPacketLifeTime:a,maxRetransmits:c,protocol:s};E.debug("receiveDataChannel() [options:%o]",p);let l=this._pc.createDataChannel(t,p);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();let o={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);let d=await this._pc.createAnswer();if(!this._transportReady){let u=le.parse(d.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:u})}E.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setLocalDescription(d),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=le.parse(this._pc.localDescription.sdp));let s=tt.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,n)=>{this.safeEmit("@connect",{dtlsParameters:s},i,n)}),this._transportReady=!0}onIceGatheringStateChange=()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)};onIceCandidateError=e=>{this.emit("@icecandidateerror",e)};onConnectionStateChange=()=>{this.emit("@connectionstatechange",this._pc.connectionState)};onIceConnectionStateChange=()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}};assertNotClosed(){if(this._closed)throw new Ia.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};It.Chrome111=Cr});var Ys=y(Mt=>{"use strict";Object.defineProperty(Mt,"__esModule",{value:!0});Mt.Chrome74=void 0;var Y=pe(),Oa=A(),ja=$(),rt=se(),Na=Q(),Aa=Ce(),qa=Be(),st=Ue(),Sr=Ve(),Rr=He(),C=new Oa.Logger("Chrome74"),Js="Chrome74",Zs={OS:1024,MIS:1024},Er=class r extends ja.EnhancedEventEmitter{_closed=!1;_direction;_remoteSdp;_getSendExtendedRtpCapabilities;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return{name:Js,factory:e=>new r(e),getNativeRtpCapabilities:async()=>{C.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");let t=await e.createOffer();try{e.close()}catch{}e=void 0;let s=Y.parse(t.sdp);return r.getLocalRtpCapabilities(s)}catch(t){try{e?.close()}catch{}throw e=void 0,t}},getNativeSctpCapabilities:async()=>(C.debug("getNativeSctpCapabilities()"),{numStreams:Zs})}}static getLocalRtpCapabilities(e,t=[]){let s=st.extractRtpCapabilities({sdpObject:e});rt.validateAndNormalizeRtpCapabilities(s),Rr.addNackSupportForOpus(s);for(let i of t)Rr.addHeaderExtensionSupport(s,i);return s}constructor({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:n,iceServers:a,iceTransportPolicy:c,additionalSettings:p,getSendExtendedRtpCapabilities:l}){super(),C.debug("constructor()"),this._direction=e,this._remoteSdp=new qa.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:n}),this._getSendExtendedRtpCapabilities=l,i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a??[],iceTransportPolicy:c??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...p}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(C.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}get name(){return Js}close(){if(C.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(e){this.assertNotClosed(),C.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),C.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});C.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let s={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();C.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,streamId:t,encodings:s,codecOptions:i,headerExtensionOptions:n,codec:a}){this.assertNotClosed(),this.assertSendDirection(),C.debug("send() [kind:%s, track.id:%s, streamId:%s]",e.kind,e.id,t),s&&s.length>1&&s.forEach((k,D)=>{k.rid=`r${D}`});let c=this._remoteSdp.getNextMediaSectionIdx(),p=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:s}),l=await this._pc.createOffer(),o=Y.parse(l.sdp);o.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let d=[];d.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:e.kind,direction:"sendonly"});let u=r.getLocalRtpCapabilities(o,d),f=this._getSendExtendedRtpCapabilities(u),g=rt.getSendingRtpParameters(e.kind,f);g.codecs=rt.reduceCodecs(g.codecs,a);let h=rt.getSendingRemoteRtpParameters(e.kind,f);h.codecs=rt.reduceCodecs(h.codecs,a),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o});let m=!1,_=(0,Aa.parse)((s??[{}])[0].scalabilityMode),R;s?.length===1&&_.spatialLayers>1&&g.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(C.debug("send() | enabling legacy simulcast for VP9 SVC"),m=!0,o=Y.parse(l.sdp),R=o.media[c.idx],Sr.addLegacySimulcast({offerMediaObject:R,numStreams:_.spatialLayers}),l={type:"offer",sdp:Y.write(o)}),C.debug("send() | calling pc.setLocalDescription() [offer:%o]",l),n?.absCaptureTime&&(R=o.media[c.idx],st.addHeaderExtension({offerMediaObject:R,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:h.headerExtensions.find(k=>k.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),l={type:"offer",sdp:Y.write(o)}),await this._pc.setLocalDescription(l);let P=p.mid;if(g.mid=P,o=Y.parse(this._pc.localDescription.sdp),R=o.media[c.idx],g.rtcp.cname=st.getCname({offerMediaObject:R}),g.msid=`${t??this._sendStream.id} ${e.id}`,!s)g.encodings=Sr.getRtpEncodings({offerMediaObject:R});else if(s.length===1){let k=Sr.getRtpEncodings({offerMediaObject:R});Object.assign(k[0],s[0]),m&&(k=[k[0]]),g.encodings=k}else g.encodings=s;if(g.encodings.length>1&&(g.codecs[0].mimeType.toLowerCase()==="video/vp8"||g.codecs[0].mimeType.toLowerCase()==="video/h264"))for(let k of g.encodings)k.scalabilityMode?k.scalabilityMode=`L1T${_.temporalLayers}`:k.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:R,reuseMid:c.reuseMid,offerRtpParameters:g,answerRtpParameters:h,codecOptions:i});let x={type:"answer",sdp:this._remoteSdp.getSdp()};return C.debug("send() | calling pc.setRemoteDescription() [answer:%o]",x),await this._pc.setRemoteDescription(x),this._mapMidTransceiver.set(P,p),{localId:P,rtpParameters:g,rtpSender:p.sender}}async stopSending(e){if(this.assertSendDirection(),C.debug("stopSending() [localId:%s]",e),this._closed)return;let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}let i=await this._pc.createOffer();C.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);let n={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),C.debug("pauseSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);let s=await this._pc.createOffer();C.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),C.debug("resumeSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";let s=await this._pc.createOffer();C.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?C.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):C.debug("replaceTrack() [localId:%s, no track]",e);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");await s.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),C.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");let i=s.sender.getParameters();i.encodings.forEach((c,p)=>{p<=t?c.active=!0:c.active=!1}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let n=await this._pc.createOffer();C.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);let a={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),C.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");let i=s.sender.getParameters();i.encodings.forEach((c,p)=>{i.encodings[p]={...c,...t}}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let n=await this._pc.createOffer();C.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);let a={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:i,protocol:n}){this.assertNotClosed(),this.assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,protocol:n};C.debug("sendDataChannel() [options:%o]",a);let c=this._pc.createDataChannel(i,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Zs.MIS,!this._hasDataChannelMediaSection){let l=await this._pc.createOffer(),o=Y.parse(l.sdp),d=o.media.find(f=>f.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),C.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:d});let u={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u),this._hasDataChannelMediaSection=!0}let p={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:c,sctpStreamParameters:p}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();let t=[],s=new Map;for(let c of e){let{trackId:p,kind:l,rtpParameters:o,streamId:d}=c;C.debug("receive() [trackId:%s, kind:%s]",p,l);let u=o.mid??String(this._mapMidTransceiver.size);s.set(p,u);let{msidStreamId:f}=Rr.getMsidStreamIdAndTrackId(o.msid);this._remoteSdp.receive({mid:u,kind:l,offerRtpParameters:o,streamId:d??f??o.rtcp?.cname??"-",trackId:p})}let i={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let n=await this._pc.createAnswer(),a=Y.parse(n.sdp);for(let c of e){let{trackId:p,rtpParameters:l}=c,o=s.get(p),d=a.media.find(u=>String(u.mid)===o);st.applyCodecParameters({offerRtpParameters:l,answerMediaObject:d})}n={type:"answer",sdp:Y.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),C.debug("receive() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(let c of e){let{trackId:p}=c,l=s.get(p),o=this._pc.getTransceivers().find(d=>d.mid===l);if(o)this._mapMidTransceiver.set(l,o),t.push({localId:l,track:o.receiver.track,rtpReceiver:o.receiver});else throw new Error("new RTCRtpTransceiver not found")}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(let i of e){C.debug("stopReceiving() [localId:%s]",i);let n=this._mapMidTransceiver.get(i);if(!n)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(n.mid)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();C.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(let i of e)this._mapMidTransceiver.delete(i)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(let i of e){C.debug("pauseReceiving() [localId:%s]",i);let n=this._mapMidTransceiver.get(i);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="inactive",this._remoteSdp.pauseMediaSection(i)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();C.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(let i of e){C.debug("resumeReceiving() [localId:%s]",i);let n=this._mapMidTransceiver.get(i);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();C.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertNotClosed(),this.assertRecvDirection();let{streamId:i,ordered:n,maxPacketLifeTime:a,maxRetransmits:c}=e,p={negotiated:!0,id:i,ordered:n,maxPacketLifeTime:a,maxRetransmits:c,protocol:s};C.debug("receiveDataChannel() [options:%o]",p);let l=this._pc.createDataChannel(t,p);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();let o={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);let d=await this._pc.createAnswer();if(!this._transportReady){let u=Y.parse(d.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:u})}C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setLocalDescription(d),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=Y.parse(this._pc.localDescription.sdp));let s=st.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,n)=>{this.safeEmit("@connect",{dtlsParameters:s},i,n)}),this._transportReady=!0}onIceGatheringStateChange=()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)};onIceCandidateError=e=>{this.emit("@icecandidateerror",e)};onConnectionStateChange=()=>{this.emit("@connectionstatechange",this._pc.connectionState)};onIceConnectionStateChange=()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}};assertNotClosed(){if(this._closed)throw new Na.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};Mt.Chrome74=Er});var si=y(Ot=>{"use strict";Object.defineProperty(Ot,"__esModule",{value:!0});Ot.Firefox120=void 0;var me=pe(),za=$(),$a=A(),Xs=Q(),it=se(),Ba=Ce(),Ua=Be(),Ft=Ue(),ei=Ve(),Va=He(),T=new $a.Logger("Firefox120"),ti="Firefox120",ri={OS:16,MIS:2048},Tr=class r extends za.EnhancedEventEmitter{_closed=!1;_direction;_remoteSdp;_getSendExtendedRtpCapabilities;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return{name:ti,factory:e=>new r(e),getNativeRtpCapabilities:async()=>{T.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");let i=t.captureStream().getVideoTracks()[0];try{e.addTransceiver("audio",{direction:"sendrecv"}),e.addTransceiver(i,{direction:"sendrecv",sendEncodings:[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}]});let n=await e.createOffer();try{t.remove()}catch{}try{i.stop()}catch{}try{e.close()}catch{}e=void 0;let a=me.parse(n.sdp);return r.getLocalRtpCapabilities(a)}catch(n){try{t.remove()}catch{}try{i.stop()}catch{}try{e?.close()}catch{}throw e=void 0,n}},getNativeSctpCapabilities:async()=>(T.debug("getNativeSctpCapabilities()"),{numStreams:ri})}}static getLocalRtpCapabilities(e){let t=Ft.extractRtpCapabilities({sdpObject:e});return it.validateAndNormalizeRtpCapabilities(t),t}constructor({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:n,iceServers:a,iceTransportPolicy:c,additionalSettings:p,getSendExtendedRtpCapabilities:l}){super(),T.debug("constructor()"),this._direction=e,this._remoteSdp=new Ua.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:n}),this._getSendExtendedRtpCapabilities=l,this._pc=new RTCPeerConnection({iceServers:a??[],iceTransportPolicy:c??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...p}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(T.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}get name(){return ti}close(){if(T.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(e){throw this.assertNotClosed(),new Xs.UnsupportedError("not supported")}async restartIce(e){if(this.assertNotClosed(),T.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});T.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let s={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();T.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,streamId:t,encodings:s,codecOptions:i,codec:n,onRtpSender:a}){this.assertNotClosed(),this.assertSendDirection(),T.debug("send() [kind:%s, track.id:%s, streamId:%s]",e.kind,e.id,t),s&&s.length>1&&s.forEach((R,P)=>{R.rid=`r${P}`});let c=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:s});a&&a(c.sender);let p=await this._pc.createOffer(),l=me.parse(p.sdp);l.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let o=r.getLocalRtpCapabilities(l),d=this._getSendExtendedRtpCapabilities(o),u=it.getSendingRtpParameters(e.kind,d);u.codecs=it.reduceCodecs(u.codecs,n);let f=it.getSendingRemoteRtpParameters(e.kind,d);f.codecs=it.reduceCodecs(f.codecs,n),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:l});let g=(0,Ba.parse)((s??[{}])[0].scalabilityMode);T.debug("send() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p);let h=c.mid;u.mid=h,l=me.parse(this._pc.localDescription.sdp);let m=l.media[l.media.length-1];if(u.rtcp.cname=Ft.getCname({offerMediaObject:m}),u.msid=`${t??this._sendStream.id} ${e.id}`,!s)u.encodings=ei.getRtpEncodings({offerMediaObject:m});else if(s.length===1){let R=ei.getRtpEncodings({offerMediaObject:m});Object.assign(R[0],s[0]),u.encodings=R}else u.encodings=s;if(u.encodings.length>1&&(u.codecs[0].mimeType.toLowerCase()==="video/vp8"||u.codecs[0].mimeType.toLowerCase()==="video/h264"))for(let R of u.encodings)R.scalabilityMode?R.scalabilityMode=`L1T${g.temporalLayers}`:R.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:m,offerRtpParameters:u,answerRtpParameters:f,codecOptions:i});let _={type:"answer",sdp:this._remoteSdp.getSdp()};return T.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_),this._mapMidTransceiver.set(h,c),{localId:h,rtpParameters:u,rtpSender:c.sender}}async stopSending(e){if(this.assertSendDirection(),T.debug("stopSending() [localId:%s]",e),this._closed)return;let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);let s=await this._pc.createOffer();T.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),T.debug("pauseSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);let s=await this._pc.createOffer();T.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),T.debug("resumeSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);let s=await this._pc.createOffer();T.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?T.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):T.debug("replaceTrack() [localId:%s, no track]",e);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");await s.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),T.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated transceiver not found");let i=s.sender.getParameters();i.encodings.forEach((c,p)=>{p<=t?c.active=!0:c.active=!1}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let n=await this._pc.createOffer();T.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);let a={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),T.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");let i=s.sender.getParameters();i.encodings.forEach((c,p)=>{i.encodings[p]={...c,...t}}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let n=await this._pc.createOffer();T.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);let a={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:i,protocol:n}){this.assertNotClosed(),this.assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,protocol:n};T.debug("sendDataChannel() [options:%o]",a);let c=this._pc.createDataChannel(i,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%ri.MIS,!this._hasDataChannelMediaSection){let l=await this._pc.createOffer(),o=me.parse(l.sdp),d=o.media.find(f=>f.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:o}),T.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:d});let u={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u),this._hasDataChannelMediaSection=!0}let p={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:c,sctpStreamParameters:p}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();let t=[],s=new Map;for(let c of e){let{trackId:p,kind:l,rtpParameters:o,streamId:d}=c;T.debug("receive() [trackId:%s, kind:%s]",p,l);let u=o.mid??String(this._mapMidTransceiver.size);s.set(p,u);let{msidStreamId:f}=Va.getMsidStreamIdAndTrackId(o.msid);this._remoteSdp.receive({mid:u,kind:l,offerRtpParameters:o,streamId:d??f??o.rtcp?.cname??"-",trackId:p})}let i={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);for(let c of e){let{trackId:p,onRtpReceiver:l}=c;if(l){let o=s.get(p),d=this._pc.getTransceivers().find(u=>u.mid===o);if(!d)throw new Error("transceiver not found");l(d.receiver)}}let n=await this._pc.createAnswer(),a=me.parse(n.sdp);for(let c of e){let{trackId:p,rtpParameters:l}=c,o=s.get(p),d=a.media.find(u=>String(u.mid)===o);Ft.applyCodecParameters({offerRtpParameters:l,answerMediaObject:d}),n={type:"answer",sdp:me.write(a)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:a}),T.debug("receive() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(let c of e){let{trackId:p}=c,l=s.get(p),o=this._pc.getTransceivers().find(d=>d.mid===l);if(!o)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(l,o),t.push({localId:l,track:o.receiver.track,rtpReceiver:o.receiver})}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(let i of e){T.debug("stopReceiving() [localId:%s]",i);let n=this._mapMidTransceiver.get(i);if(!n)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(n.mid)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();T.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(let i of e)this._mapMidTransceiver.delete(i)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(let i of e){T.debug("pauseReceiving() [localId:%s]",i);let n=this._mapMidTransceiver.get(i);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="inactive",this._remoteSdp.pauseMediaSection(i)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();T.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(let i of e){T.debug("resumeReceiving() [localId:%s]",i);let n=this._mapMidTransceiver.get(i);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();T.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertRecvDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertNotClosed(),this.assertRecvDirection();let{streamId:i,ordered:n,maxPacketLifeTime:a,maxRetransmits:c}=e,p={negotiated:!0,id:i,ordered:n,maxPacketLifeTime:a,maxRetransmits:c,protocol:s};T.debug("receiveDataChannel() [options:%o]",p);let l=this._pc.createDataChannel(t,p);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();let o={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);let d=await this._pc.createAnswer();if(!this._transportReady){let u=me.parse(d.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:u})}T.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setLocalDescription(d),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=me.parse(this._pc.localDescription.sdp));let s=Ft.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,n)=>{this.safeEmit("@connect",{dtlsParameters:s},i,n)}),this._transportReady=!0}onIceGatheringStateChange=()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)};onIceCandidateError=e=>{this.emit("@icecandidateerror",e)};onConnectionStateChange=()=>{this.emit("@connectionstatechange",this._pc.connectionState)};onIceConnectionStateChange=()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}};assertNotClosed(){if(this._closed)throw new Xs.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};Ot.Firefox120=Tr});var oi=y(jt=>{"use strict";Object.defineProperty(jt,"__esModule",{value:!0});jt.Safari12=void 0;var X=pe(),Ha=$(),Ga=A(),nt=se(),Qa=Q(),Ka=Ce(),Wa=Be(),at=Ue(),ii=Ve(),xr=He(),S=new Ga.Logger("Safari12"),ni="Safari12",ai={OS:1024,MIS:1024},kr=class r extends Ha.EnhancedEventEmitter{_closed=!1;_direction;_remoteSdp;_getSendExtendedRtpCapabilities;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return{name:ni,factory:e=>new r(e),getNativeRtpCapabilities:async()=>{S.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");let t=await e.createOffer();try{e.close()}catch{}e=void 0;let s=X.parse(t.sdp);return r.getLocalRtpCapabilities(s)}catch(t){try{e?.close()}catch{}throw e=void 0,t}},getNativeSctpCapabilities:async()=>(S.debug("getNativeSctpCapabilities()"),{numStreams:ai})}}static getLocalRtpCapabilities(e,t=[]){let s=at.extractRtpCapabilities({sdpObject:e});nt.validateAndNormalizeRtpCapabilities(s),xr.addNackSupportForOpus(s);for(let i of t)xr.addHeaderExtensionSupport(s,i);return s}constructor({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:n,iceServers:a,iceTransportPolicy:c,additionalSettings:p,getSendExtendedRtpCapabilities:l}){super(),S.debug("constructor()"),this._direction=e,this._remoteSdp=new Wa.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:n}),this._getSendExtendedRtpCapabilities=l,i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a??[],iceTransportPolicy:c??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...p}),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",o=>{this.emit("@icecandidateerror",o)}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(S.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}get name(){return ni}close(){if(S.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(e){this.assertNotClosed(),S.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),S.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});S.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let s={type:"answer",sdp:this._remoteSdp.getSdp()};S.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};S.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();S.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,streamId:t,encodings:s,codecOptions:i,headerExtensionOptions:n,codec:a,onRtpSender:c}){this.assertNotClosed(),this.assertSendDirection(),S.debug("send() [kind:%s, track.id:%s, streamId:%s]",e.kind,e.id,t);let p=this._remoteSdp.getNextMediaSectionIdx(),l=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});c&&c(l.sender);let o=await this._pc.createOffer(),d=X.parse(o.sdp);d.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let u=[];u.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:e.kind,direction:"sendonly"});let f=r.getLocalRtpCapabilities(d,u),g=this._getSendExtendedRtpCapabilities(f),h=nt.getSendingRtpParameters(e.kind,g);h.codecs=nt.reduceCodecs(h.codecs,a);let m=nt.getSendingRemoteRtpParameters(e.kind,g);m.codecs=nt.reduceCodecs(m.codecs,a);let _;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d});let R=(0,Ka.parse)((s??[{}])[0].scalabilityMode);s&&s.length>1&&(S.debug("send() | enabling legacy simulcast"),d=X.parse(o.sdp),_=d.media[p.idx],ii.addLegacySimulcast({offerMediaObject:_,numStreams:s.length}),o={type:"offer",sdp:X.write(d)}),n?.absCaptureTime&&(_=d.media[p.idx],at.addHeaderExtension({offerMediaObject:_,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:m.headerExtensions.find(k=>k.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),o={type:"offer",sdp:X.write(d)}),S.debug("send() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);let P=l.mid;if(h.mid=P,d=X.parse(this._pc.localDescription.sdp),_=d.media[p.idx],h.rtcp.cname=at.getCname({offerMediaObject:_}),h.msid=`${t??this._sendStream.id} ${e.id}`,h.encodings=ii.getRtpEncodings({offerMediaObject:_}),s)for(let k=0;k<h.encodings.length;++k)s[k]&&Object.assign(h.encodings[k],s[k]);if(h.encodings.length>1&&(h.codecs[0].mimeType.toLowerCase()==="video/vp8"||h.codecs[0].mimeType.toLowerCase()==="video/h264"))for(let k of h.encodings)k.scalabilityMode?k.scalabilityMode=`L1T${R.temporalLayers}`:k.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:_,reuseMid:p.reuseMid,offerRtpParameters:h,answerRtpParameters:m,codecOptions:i});let x={type:"answer",sdp:this._remoteSdp.getSdp()};return S.debug("send() | calling pc.setRemoteDescription() [answer:%o]",x),await this._pc.setRemoteDescription(x),this._mapMidTransceiver.set(P,l),{localId:P,rtpParameters:h,rtpSender:l.sender}}async stopSending(e){if(this.assertSendDirection(),this._closed)return;S.debug("stopSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}let i=await this._pc.createOffer();S.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);let n={type:"answer",sdp:this._remoteSdp.getSdp()};S.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),S.debug("pauseSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);let s=await this._pc.createOffer();S.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};S.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),S.debug("resumeSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);let s=await this._pc.createOffer();S.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};S.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?S.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):S.debug("replaceTrack() [localId:%s, no track]",e);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");await s.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),S.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");let i=s.sender.getParameters();i.encodings.forEach((c,p)=>{p<=t?c.active=!0:c.active=!1}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let n=await this._pc.createOffer();S.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);let a={type:"answer",sdp:this._remoteSdp.getSdp()};S.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),S.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");let i=s.sender.getParameters();i.encodings.forEach((c,p)=>{i.encodings[p]={...c,...t}}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let n=await this._pc.createOffer();S.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);let a={type:"answer",sdp:this._remoteSdp.getSdp()};S.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:i,protocol:n}){this.assertNotClosed(),this.assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,protocol:n};S.debug("sendDataChannel() [options:%o]",a);let c=this._pc.createDataChannel(i,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%ai.MIS,!this._hasDataChannelMediaSection){let l=await this._pc.createOffer(),o=X.parse(l.sdp),d=o.media.find(f=>f.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),S.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:d});let u={type:"answer",sdp:this._remoteSdp.getSdp()};S.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u),this._hasDataChannelMediaSection=!0}let p={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:c,sctpStreamParameters:p}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();let t=[],s=new Map;for(let c of e){let{trackId:p,kind:l,rtpParameters:o,streamId:d}=c;S.debug("receive() [trackId:%s, kind:%s]",p,l);let u=o.mid??String(this._mapMidTransceiver.size);s.set(p,u);let{msidStreamId:f}=xr.getMsidStreamIdAndTrackId(o.msid);this._remoteSdp.receive({mid:u,kind:l,offerRtpParameters:o,streamId:d??f??o.rtcp?.cname??"-",trackId:p})}let i={type:"offer",sdp:this._remoteSdp.getSdp()};S.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);for(let c of e){let{trackId:p,onRtpReceiver:l}=c;if(l){let o=s.get(p),d=this._pc.getTransceivers().find(u=>u.mid===o);if(!d)throw new Error("transceiver not found");l(d.receiver)}}let n=await this._pc.createAnswer(),a=X.parse(n.sdp);for(let c of e){let{trackId:p,rtpParameters:l}=c,o=s.get(p),d=a.media.find(u=>String(u.mid)===o);at.applyCodecParameters({offerRtpParameters:l,answerMediaObject:d})}n={type:"answer",sdp:X.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),S.debug("receive() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(let c of e){let{trackId:p}=c,l=s.get(p),o=this._pc.getTransceivers().find(d=>d.mid===l);if(!o)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(l,o),t.push({localId:l,track:o.receiver.track,rtpReceiver:o.receiver})}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(let i of e){S.debug("stopReceiving() [localId:%s]",i);let n=this._mapMidTransceiver.get(i);if(!n)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(n.mid)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};S.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();S.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(let i of e)this._mapMidTransceiver.delete(i)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(let i of e){S.debug("pauseReceiving() [localId:%s]",i);let n=this._mapMidTransceiver.get(i);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="inactive",this._remoteSdp.pauseMediaSection(i)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};S.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();S.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(let i of e){S.debug("resumeReceiving() [localId:%s]",i);let n=this._mapMidTransceiver.get(i);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};S.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();S.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertNotClosed(),this.assertRecvDirection();let{streamId:i,ordered:n,maxPacketLifeTime:a,maxRetransmits:c}=e,p={negotiated:!0,id:i,ordered:n,maxPacketLifeTime:a,maxRetransmits:c,protocol:s};S.debug("receiveDataChannel() [options:%o]",p);let l=this._pc.createDataChannel(t,p);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();let o={type:"offer",sdp:this._remoteSdp.getSdp()};S.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);let d=await this._pc.createAnswer();if(!this._transportReady){let u=X.parse(d.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:u})}S.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setLocalDescription(d),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=X.parse(this._pc.localDescription.sdp));let s=at.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,n)=>{this.safeEmit("@connect",{dtlsParameters:s},i,n)}),this._transportReady=!0}onIceGatheringStateChange=()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)};onIceCandidateError=e=>{this.emit("@icecandidateerror",e)};onConnectionStateChange=()=>{this.emit("@connectionstatechange",this._pc.connectionState)};onIceConnectionStateChange=()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}};assertNotClosed(){if(this._closed)throw new Qa.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};jt.Safari12=kr});var pi=y(Nt=>{"use strict";Object.defineProperty(Nt,"__esModule",{value:!0});Nt.ReactNative106=void 0;var ee=pe(),Ja=$(),Za=A(),ot=se(),Ya=Q(),Xa=Ce(),eo=Be(),ct=Ue(),Dr=Ve(),Pr=He(),b=new Za.Logger("ReactNative106"),ci="ReactNative106",di={OS:1024,MIS:1024},Lr=class r extends Ja.EnhancedEventEmitter{_closed=!1;_direction;_remoteSdp;_getSendExtendedRtpCapabilities;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return{name:ci,factory:e=>new r(e),getNativeRtpCapabilities:async()=>{b.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");let t=await e.createOffer();try{e.close()}catch{}e=void 0;let s=ee.parse(t.sdp);return r.getLocalRtpCapabilities(s)}catch(t){try{e?.close()}catch{}throw e=void 0,t}},getNativeSctpCapabilities:async()=>(b.debug("getNativeSctpCapabilities()"),{numStreams:di})}}static getLocalRtpCapabilities(e,t=[]){let s=ct.extractRtpCapabilities({sdpObject:e});ot.validateAndNormalizeRtpCapabilities(s),Pr.addNackSupportForOpus(s);for(let i of t)Pr.addHeaderExtensionSupport(s,i);return s}constructor({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:n,iceServers:a,iceTransportPolicy:c,additionalSettings:p,getSendExtendedRtpCapabilities:l}){super(),b.debug("constructor()"),this._direction=e,this._remoteSdp=new eo.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:n}),this._getSendExtendedRtpCapabilities=l,i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a??[],iceTransportPolicy:c??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...p}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(b.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}get name(){return ci}close(){if(b.debug("close()"),!this._closed){this._closed=!0,this._sendStream.release(!1);try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(e){this.assertNotClosed(),b.debug("updateIceServers()");let t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),b.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){let t=await this._pc.createOffer({iceRestart:!0});b.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);let s={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}else{let t={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();b.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,streamId:t,encodings:s,codecOptions:i,headerExtensionOptions:n,codec:a,onRtpSender:c}){this.assertNotClosed(),this.assertSendDirection(),b.debug("send() [kind:%s, track.id:%s, streamId:%s]",e.kind,e.id,t),s&&s.length>1&&s.forEach((D,re)=>{D.rid=`r${re}`});let p=this._remoteSdp.getNextMediaSectionIdx(),l=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:s});c&&c(l.sender);let o=await this._pc.createOffer(),d=ee.parse(o.sdp);d.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let u=[];u.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:e.kind,direction:"sendonly"});let f=r.getLocalRtpCapabilities(d,u),g=this._getSendExtendedRtpCapabilities(f),h=ot.getSendingRtpParameters(e.kind,g);h.codecs=ot.reduceCodecs(h.codecs,a);let m=ot.getSendingRemoteRtpParameters(e.kind,g);m.codecs=ot.reduceCodecs(m.codecs,a),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d});let _=!1,R=(0,Xa.parse)((s??[{}])[0].scalabilityMode),P;s?.length===1&&R.spatialLayers>1&&h.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(b.debug("send() | enabling legacy simulcast for VP9 SVC"),_=!0,d=ee.parse(o.sdp),P=d.media[p.idx],Dr.addLegacySimulcast({offerMediaObject:P,numStreams:R.spatialLayers}),o={type:"offer",sdp:ee.write(d)}),n?.absCaptureTime&&(P=d.media[p.idx],ct.addHeaderExtension({offerMediaObject:P,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:m.headerExtensions.find(D=>D.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),o={type:"offer",sdp:ee.write(d)}),b.debug("send() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);let x=l.mid??void 0;if(x||b.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),h.mid=x,d=ee.parse(this._pc.localDescription.sdp),P=d.media[p.idx],h.rtcp.cname=ct.getCname({offerMediaObject:P}),h.msid=`${t??this._sendStream.id} ${e.id}`,!s)h.encodings=Dr.getRtpEncodings({offerMediaObject:P});else if(s.length===1){let D=Dr.getRtpEncodings({offerMediaObject:P});Object.assign(D[0],s[0]),_&&(D=[D[0]]),h.encodings=D}else h.encodings=s;if(h.encodings.length>1&&(h.codecs[0].mimeType.toLowerCase()==="video/vp8"||h.codecs[0].mimeType.toLowerCase()==="video/h264"))for(let D of h.encodings)D.scalabilityMode?D.scalabilityMode=`L1T${R.temporalLayers}`:D.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:P,reuseMid:p.reuseMid,offerRtpParameters:h,answerRtpParameters:m,codecOptions:i});let k={type:"answer",sdp:this._remoteSdp.getSdp()};return b.debug("send() | calling pc.setRemoteDescription() [answer:%o]",k),await this._pc.setRemoteDescription(k),x||(x=l.mid,h.mid=x),this._mapMidTransceiver.set(x,l),{localId:x,rtpParameters:h,rtpSender:l.sender}}async stopSending(e){if(this.assertSendDirection(),this._closed)return;b.debug("stopSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}let i=await this._pc.createOffer();b.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);let n={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),b.debug("pauseSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);let s=await this._pc.createOffer();b.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),b.debug("resumeSending() [localId:%s]",e);let t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";let s=await this._pc.createOffer();b.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);let i={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?b.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):b.debug("replaceTrack() [localId:%s, no track]",e);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");await s.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),b.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");let i=s.sender.getParameters();i.encodings.forEach((c,p)=>{p<=t?c.active=!0:c.active=!1}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let n=await this._pc.createOffer();b.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);let a={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),b.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);let s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");let i=s.sender.getParameters();i.encodings.forEach((c,p)=>{i.encodings[p]={...c,...t}}),await s.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(e,i.encodings);let n=await this._pc.createOffer();b.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);let a={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:i,protocol:n}){this.assertNotClosed(),this.assertSendDirection();let a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,protocol:n};b.debug("sendDataChannel() [options:%o]",a);let c=this._pc.createDataChannel(i,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%di.MIS,!this._hasDataChannelMediaSection){let l=await this._pc.createOffer(),o=ee.parse(l.sdp),d=o.media.find(f=>f.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:o}),b.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:d});let u={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u),this._hasDataChannelMediaSection=!0}let p={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:c,sctpStreamParameters:p}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();let t=[],s=new Map;for(let c of e){let{trackId:p,kind:l,rtpParameters:o,streamId:d}=c;b.debug("receive() [trackId:%s, kind:%s]",p,l);let u=o.mid??String(this._mapMidTransceiver.size);s.set(p,u);let{msidStreamId:f}=Pr.getMsidStreamIdAndTrackId(o.msid);this._remoteSdp.receive({mid:u,kind:l,offerRtpParameters:o,streamId:d??f??o.rtcp?.cname??"-",trackId:p})}let i={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);for(let c of e){let{trackId:p,onRtpReceiver:l}=c;if(l){let o=s.get(p),d=this._pc.getTransceivers().find(u=>u.mid===o);if(!d)throw new Error("transceiver not found");l(d.receiver)}}let n=await this._pc.createAnswer(),a=ee.parse(n.sdp);for(let c of e){let{trackId:p,rtpParameters:l}=c,o=s.get(p),d=a.media.find(u=>String(u.mid)===o);ct.applyCodecParameters({offerRtpParameters:l,answerMediaObject:d})}n={type:"answer",sdp:ee.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),b.debug("receive() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(let c of e){let{trackId:p}=c,l=s.get(p),o=this._pc.getTransceivers().find(d=>d.mid===l);if(o)this._mapMidTransceiver.set(l,o),t.push({localId:l,track:o.receiver.track,rtpReceiver:o.receiver});else throw new Error("new RTCRtpTransceiver not found")}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(let i of e){b.debug("stopReceiving() [localId:%s]",i);let n=this._mapMidTransceiver.get(i);if(!n)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(n.mid)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();b.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s);for(let i of e)this._mapMidTransceiver.delete(i)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(let i of e){b.debug("pauseReceiving() [localId:%s]",i);let n=this._mapMidTransceiver.get(i);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="inactive",this._remoteSdp.pauseMediaSection(i)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();b.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(let i of e){b.debug("resumeReceiving() [localId:%s]",i);let n=this._mapMidTransceiver.get(i);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(i)}let t={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let s=await this._pc.createAnswer();b.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();let t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this.assertNotClosed(),this.assertRecvDirection();let{streamId:i,ordered:n,maxPacketLifeTime:a,maxRetransmits:c}=e,p={negotiated:!0,id:i,ordered:n,maxPacketLifeTime:a,maxRetransmits:c,protocol:s};b.debug("receiveDataChannel() [options:%o]",p);let l=this._pc.createDataChannel(t,p);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();let o={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);let d=await this._pc.createAnswer();if(!this._transportReady){let u=ee.parse(d.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:u})}b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setLocalDescription(d),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=ee.parse(this._pc.localDescription.sdp));let s=ct.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((i,n)=>{this.safeEmit("@connect",{dtlsParameters:s},i,n)}),this._transportReady=!0}onIceGatheringStateChange=()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)};onIceCandidateError=e=>{this.emit("@icecandidateerror",e)};onConnectionStateChange=()=>{this.emit("@connectionstatechange",this._pc.connectionState)};onIceConnectionStateChange=()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}};assertNotClosed(){if(this._closed)throw new Ya.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};Nt.ReactNative106=Lr});var fi=y(Ge=>{"use strict";Object.defineProperty(Ge,"__esModule",{value:!0});Ge.Device=void 0;Ge.detectDevice=li;Ge.detectDeviceAsync=ui;var to=A(),ro=$(),Re=Q(),Ir=ve(),ue=se(),so=Fs(),io=Ws(),no=Ys(),ao=si(),oo=oi(),co=pi(),w=new to.Logger("Device");function li(r,e){return w.debug("detectDevice()"),!r&&typeof navigator=="object"&&(r=navigator.userAgent),!e&&typeof navigator=="object"&&(e=navigator.userAgentData),hi(r,e)}async function ui(r,e){return w.debug("detectDeviceAsync()"),!r&&typeof navigator=="object"&&(r=navigator.userAgent),!e&&typeof navigator=="object"&&(e=navigator.userAgentData),hi(r,e)}var Mr=class r{_handlerFactory;_handlerName;_loaded=!1;_getSendExtendedRtpCapabilities;_recvRtpCapabilities;_canProduceByKind={audio:!1,video:!1};_sctpCapabilities;_observer=new ro.EnhancedEventEmitter;static async factory({handlerName:e,handlerFactory:t}={}){if(w.debug("factory()"),e&&t)throw new TypeError("just one of handlerName or handlerInterface can be given");if(!e&&!t&&(e=await ui(),!e))throw new Re.UnsupportedError("device not supported");return new r({handlerName:e,handlerFactory:t})}constructor({handlerName:e,handlerFactory:t}={}){if(w.debug("constructor()"),e&&t)throw new TypeError("just one of handlerName or handlerInterface can be given");if(t)this._handlerFactory=t;else{if(e)w.debug("constructor() | handler given: %s",e);else if(e=li(),e)w.debug("constructor() | detected handler: %s",e);else throw new Re.UnsupportedError("device not supported");switch(e){case"Chrome111":{this._handlerFactory=io.Chrome111.createFactory();break}case"Chrome74":{this._handlerFactory=no.Chrome74.createFactory();break}case"Firefox120":{this._handlerFactory=ao.Firefox120.createFactory();break}case"Safari12":{this._handlerFactory=oo.Safari12.createFactory();break}case"ReactNative106":{this._handlerFactory=co.ReactNative106.createFactory();break}default:throw new TypeError(`unknown handlerName "${e}"`)}}this._handlerName=this._handlerFactory.name}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new Re.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new Re.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:e,preferLocalCodecsOrder:t=!1}){if(w.debug("load() [routerRtpCapabilities:%o]",e),this._loaded)throw new Re.InvalidStateError("already loaded");let s=Ir.clone(e);ue.validateAndNormalizeRtpCapabilities(s);let{getNativeRtpCapabilities:i,getNativeSctpCapabilities:n}=this._handlerFactory,a=Ir.clone(await i());ue.validateAndNormalizeRtpCapabilities(a),w.debug("load() | got native RTP capabilities:%o",a),this._getSendExtendedRtpCapabilities=p=>Ir.clone(ue.getExtendedRtpCapabilities(p,s,t));let c=ue.getExtendedRtpCapabilities(a,s,!1);this._recvRtpCapabilities=ue.getRecvRtpCapabilities(c),ue.validateAndNormalizeRtpCapabilities(this._recvRtpCapabilities),w.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._canProduceByKind.audio=ue.canSend("audio",this._recvRtpCapabilities),this._canProduceByKind.video=ue.canSend("video",this._recvRtpCapabilities),this._sctpCapabilities=await n(),ue.validateSctpCapabilities(this._sctpCapabilities),w.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),w.debug("load() succeeded"),this._loaded=!0}canProduce(e){if(this._loaded){if(e!=="audio"&&e!=="video")throw new TypeError(`invalid kind "${e}"`)}else throw new Re.InvalidStateError("not loaded");return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:n,iceServers:a,iceTransportPolicy:c,additionalSettings:p,appData:l}){return w.debug("createSendTransport()"),this.createTransport({direction:"send",id:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:n,iceServers:a,iceTransportPolicy:c,additionalSettings:p,appData:l})}createRecvTransport({id:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:n,iceServers:a,iceTransportPolicy:c,additionalSettings:p,appData:l}){return w.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:n,iceServers:a,iceTransportPolicy:c,additionalSettings:p,appData:l})}createTransport({direction:e,id:t,iceParameters:s,iceCandidates:i,dtlsParameters:n,sctpParameters:a,iceServers:c,iceTransportPolicy:p,additionalSettings:l,appData:o}){if(this._loaded){if(typeof t!="string")throw new TypeError("missing id");if(typeof s!="object")throw new TypeError("missing iceParameters");if(Array.isArray(i)){if(typeof n!="object")throw new TypeError("missing dtlsParameters");if(a&&typeof a!="object")throw new TypeError("wrong sctpParameters");if(o&&typeof o!="object")throw new TypeError("if given, appData must be an object")}else throw new TypeError("missing iceCandidates")}else throw new Re.InvalidStateError("not loaded");let d=new so.Transport({direction:e,id:t,iceParameters:s,iceCandidates:i,dtlsParameters:n,sctpParameters:a,iceServers:c,iceTransportPolicy:p,additionalSettings:l,appData:o,handlerFactory:this._handlerFactory,getSendExtendedRtpCapabilities:this._getSendExtendedRtpCapabilities,recvRtpCapabilities:this._recvRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",d),d}};Ge.Device=Mr;function hi(r,e){w.debug('detectDeviceImpl() [userAgent:"%s", userAgentData:%o]',r,e);let t=po(r,e);if(t){if(t>=111)return w.debug("detectDeviceImpl() | using Chrome111 handler"),"Chrome111";if(t>=74)return w.debug("detectDeviceImpl() | using Chrome74 handler"),"Chrome74";w.warn("detectDeviceImpl() | unsupported Chromium based browser/version");return}let s=lo(r);if(s){if(s>=120)return w.debug("detectDeviceImpl() | using Firefox120 handler"),"Firefox120";w.warn("detectDeviceImpl() | unsupported Firefox browser/version");return}let i=uo(r);if(i){if(i>=605)return w.debug("detectDeviceImpl() | using Safari12 handler"),"Safari12";w.warn("detectDeviceImpl() | unsupported desktop Safari browser/version");return}let n=ho(r);if(n){if(n>=605)return w.debug("detectDeviceImpl() | using Safari12 handler"),"Safari12";w.warn("detectDeviceImpl() | unsupported iOS Safari based browser/version");return}if(dt()){if(typeof RTCPeerConnection<"u"&&typeof RTCRtpTransceiver<"u")return w.debug("detectDeviceImpl() | using ReactNative106 handler"),"ReactNative106";w.warn("detectDeviceImpl() | unsupported react-native-webrtc version without RTCPeerConnection or RTCRtpTransceiver, forgot to call registerGlobals() on it?");return}w.warn('detectDeviceImpl() | device not supported [userAgent:"%s", userAgentData:%o]',r,e)}function po(r,e){if(w.debug("getChromiumMajorVersion()"),At(r,e)){w.debug("getChromiumMajorVersion() | this is iOS => undefined");return}if(dt()){w.debug("getChromiumMajorVersion() | this is React-Native => undefined");return}if(e){let s=(e.brands??[]).find(i=>i.brand==="Chromium");if(s){let i=Number(s.version);return w.debug(`getChromiumMajorVersion() | Chromium major version based on NavigatorUAData => ${i}`),i}}let t=r?.match(/\b(?:Chrome|Chromium)\/(\w+)/i);if(t?.[1]){let s=Number(t[1]);return w.debug(`getChromiumMajorVersion() | Chromium major version based on User-Agent => ${s}`),s}w.debug("getChromiumMajorVersion() | this is not Chromium => undefined")}function lo(r){if(w.debug("getFirefoxMajorVersion()"),At(r)){w.debug("getFirefoxMajorVersion() | this is iOS => undefined");return}if(dt()){w.debug("getFirefoxMajorVersion() | this is React-Native => undefined");return}let e=r?.match(/\bFirefox\/(\w+)/i);if(e?.[1]){let t=Number(e[1]);return w.debug(`getFirefoxMajorVersion() | Firefox major version based on User-Agent => ${t}`),t}w.debug("getFirefoxMajorVersion() | this is not Firefox => undefined")}function uo(r){if(w.debug("getMacOSWebKitMajorVersion()"),At(r)){w.debug("getMacOSWebKitMajorVersion() | this is iOS => undefined");return}if(dt()){w.debug("getMacOSWebKitMajorVersion() | this is React-Native => undefined");return}if(!(r&&/\bSafari\b/i.test(r)&&!/\bChrome\b/i.test(r)&&!/\bChromium\b/i.test(r)&&!/\bFirefox\b/i.test(r))){w.debug("getMacOSWebKitMajorVersion() | this is not Safari => undefined");return}let t=r.match(/AppleWebKit\/(\w+)/i);if(t?.[1]){let s=Number(t[1]);return w.debug(`getMacOSWebKitMajorVersion() | WebKit major version based on User-Agent => ${s}`),s}w.debug("getMacOSWebKitMajorVersion() | this is not WebKit => undefined")}function ho(r){if(w.debug("getIOSWebKitMajorVersion()"),!At(r)){w.debug("getIOSWebKitMajorVersion() | this is not iOS => undefined");return}if(dt()){w.debug("getIOSWebKitMajorVersion() | this is React-Native => undefined");return}let e=r?.match(/AppleWebKit\/(\w+)/i);if(e?.[1]){let t=Number(e[1]);return w.debug(`getIOSWebKitMajorVersion() | WebKit major version based on User-Agent => ${t}`),t}w.debug("getIOSWebKitMajorVersion() | this is not WebKit => undefined")}function At(r,e){return w.debug("isIOS()"),e?.platform==="iOS"?(w.debug("isIOS() | this is iOS based on NavigatorUAData.platform => true"),!0):e?.platform?(w.debug("isIOS() | this is not iOS based on NavigatorUAData.platform => false"),!1):r&&/iPad|iPhone|iPod/.test(r)?(w.debug("isIOS() | this is iOS based on User-Agent => true"),!0):typeof navigator=="object"&&navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1?(w.debug("isIOS() | this is iPadOS 13+ based on User-Agent => true"),!0):(w.debug("isIOS() | this is not iOS => false"),!1)}function dt(){return w.debug("isReactNative()"),typeof navigator=="object"&&navigator.product==="ReactNative"?(w.debug("isReactNative() | this is React-Native based on navigator.product"),!0):(w.debug("isReactNative() | this is not React-Native => false"),!1)}});var gi=y(mi=>{var Ee=256,zt=[],qt;for(;Ee--;)zt[Ee]=(Ee+256).toString(16).substring(1);function fo(){var r=0,e,t="";if(!qt||Ee+16>256){for(qt=Array(r=256);r--;)qt[r]=256*Math.random()|0;r=Ee=0}for(;r<16;r++)e=qt[Ee+r],r==6?t+=zt[e&15|64]:r==8?t+=zt[e&63|128]:t+=zt[e],r&1&&r>1&&r<11&&(t+="-");return Ee++,t}mi.v4=fo});var _i=y($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.FakeEventTarget=void 0;var Fr=class{listeners={};addEventListener(e,t,s){t&&(this.listeners[e]=this.listeners[e]??[],this.listeners[e].push({callback:typeof t=="function"?t:t.handleEvent,once:typeof s=="object"&&s.once===!0}))}removeEventListener(e,t,s){this.listeners[e]&&t&&(this.listeners[e]=this.listeners[e].filter(i=>i.callback!==(typeof t=="function"?t:t.handleEvent)))}dispatchEvent(e){if(!e||typeof e.type!="string")throw new Error("invalid event object");let t=this.listeners[e.type];if(!t)return!0;for(let s of[...t]){try{s.callback.call(this,e)}catch(i){setTimeout(()=>{throw i},0)}s.once&&this.removeEventListener(e.type,s.callback)}return!e.defaultPrevented}};$t.FakeEventTarget=Fr});var vi=y(Bt=>{"use strict";Object.defineProperty(Bt,"__esModule",{value:!0});Bt.FakeEvent=void 0;var Or=class{NONE=0;CAPTURING_PHASE=1;AT_TARGET=2;BUBBLING_PHASE=3;type;bubbles;cancelable;defaultPrevented=!1;composed=!1;currentTarget=null;eventPhase=this.NONE;isTrusted=!0;target=null;timeStamp=0;cancelBubble=!1;returnValue=!0;srcElement=null;constructor(e,t={}){this.type=e,this.bubbles=t.bubbles??!1,this.cancelable=t.cancelable??!1}preventDefault(){this.cancelable&&(this.defaultPrevented=!0)}stopPropagation(){}stopImmediatePropagation(){}composedPath(){return[]}initEvent(e,t,s){}};Bt.FakeEvent=Or});var wi=y(jr=>{"use strict";Object.defineProperty(jr,"__esModule",{value:!0});jr.clone=mo;function mo(r){if(r!==void 0)return Number.isNaN(r)?NaN:typeof structuredClone=="function"?structuredClone(r):JSON.parse(JSON.stringify(r))}});var yi=y(Vt=>{"use strict";Object.defineProperty(Vt,"__esModule",{value:!0});Vt.FakeMediaStreamTrack=void 0;var bi=gi(),go=_i(),Qe=vi(),Ut=wi(),Nr=class r extends go.FakeEventTarget{#m;#l;#u;#e;#r;#t;#s;#h;#i;#f;#n;#a=null;#o=null;#c=null;#d=null;#p=null;constructor({kind:e,id:t,label:s,contentHint:i,enabled:n,muted:a,readyState:c,capabilities:p,constraints:l,settings:o,data:d}){super(),this.#m=t??(0,bi.v4)(),this.#l=e,this.#u=s??"",this.#s=i??"",this.#r=n??!0,this.#t=a??!1,this.#e=c??"live",this.#h=p??{},this.#i=l??{},this.#f=o??{},this.#n=d??{}}get id(){return this.#m}get kind(){return this.#l}get label(){return this.#u}get contentHint(){return this.#s}set contentHint(e){this.#s=e}get enabled(){return this.#r}set enabled(e){let t=this.#r!==e;this.#r=e,t&&this.dispatchEvent(new Qe.FakeEvent("enabledchange"))}get muted(){return this.#t}get readyState(){return this.#e}get data(){return this.#n}set data(e){this.#n=e}get onmute(){return this.#a}set onmute(e){this.#a&&this.removeEventListener("mute",this.#a),this.#a=e,e&&this.addEventListener("mute",e)}get onunmute(){return this.#o}set onunmute(e){this.#o&&this.removeEventListener("unmute",this.#o),this.#o=e,e&&this.addEventListener("unmute",e)}get onended(){return this.#c}set onended(e){this.#c&&this.removeEventListener("ended",this.#c),this.#c=e,e&&this.addEventListener("ended",e)}get onenabledchange(){return this.#d}set onenabledchange(e){this.#d&&this.removeEventListener("enabledchange",this.#d),this.#d=e,e&&this.addEventListener("enabledchange",e)}get onstopped(){return this.#p}set onstopped(e){this.#p&&this.removeEventListener("stopped",this.#p),this.#p=e,e&&this.addEventListener("stopped",e)}addEventListener(e,t,s){super.addEventListener(e,t,s)}removeEventListener(e,t,s){super.removeEventListener(e,t,s)}stop(){this.#e!=="ended"&&(this.#e="ended",this.dispatchEvent(new Qe.FakeEvent("stopped")))}clone({id:e,data:t}={}){return new r({id:e??(0,bi.v4)(),kind:this.#l,label:this.#u,contentHint:this.#s,enabled:this.#r,muted:this.#t,readyState:this.#e,capabilities:(0,Ut.clone)(this.#h),constraints:(0,Ut.clone)(this.#i),settings:(0,Ut.clone)(this.#f),data:t??(0,Ut.clone)(this.#n)})}getCapabilities(){return this.#h}getConstraints(){return this.#i}async applyConstraints(e={}){return this.#i=e,Promise.resolve()}getSettings(){return this.#f}remoteStop(){this.#e!=="ended"&&(this.#e="ended",this.dispatchEvent(new Qe.FakeEvent("stopped")),this.dispatchEvent(new Qe.FakeEvent("ended")))}remoteMute(){this.#t||(this.#t=!0,this.dispatchEvent(new Qe.FakeEvent("mute")))}remoteUnmute(){this.#t&&(this.#t=!1,this.dispatchEvent(new Qe.FakeEvent("unmute")))}};Vt.FakeMediaStreamTrack=Nr});var Ci=y(Ht=>{"use strict";Object.defineProperty(Ht,"__esModule",{value:!0});Ht.FakeEventTarget=void 0;var Ar=class{listeners={};addEventListener(e,t,s){t&&(this.listeners[e]=this.listeners[e]??[],this.listeners[e].push({callback:typeof t=="function"?t:t.handleEvent,once:typeof s=="object"&&s.once===!0}))}removeEventListener(e,t,s){this.listeners[e]&&t&&(this.listeners[e]=this.listeners[e].filter(i=>i.callback!==(typeof t=="function"?t:t.handleEvent)))}dispatchEvent(e){if(!e||typeof e.type!="string")throw new Error("invalid event object");let t=this.listeners[e.type];if(!t)return!0;for(let s of[...t]){try{s.callback.call(this,e)}catch(i){setTimeout(()=>{throw i},0)}s.once&&this.removeEventListener(e.type,s.callback)}return!e.defaultPrevented}};Ht.FakeEventTarget=Ar});var Ei=y(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.FakeHandler=void 0;var _o=yi(),vo=$(),wo=A(),Ke=ve(),qr=se(),Ri=Q(),bo=Ci(),N=new wo.Logger("FakeHandler"),Si="FakeHandler",zr=class r extends vo.EnhancedEventEmitter{_closed=!1;_fakeParameters;_getSendExtendedRtpCapabilities;_cname=`CNAME-${Ke.generateRandomNumber()}`;_defaultSendStreamId=`${Ke.generateRandomNumber()}`;_transportReady=!1;_nextLocalId=1;_tracks=new Map;_nextSctpStreamId=0;static createFactory(e){return{name:Si,factory:t=>new r(t,e),getNativeRtpCapabilities:async()=>(N.debug("getNativeRtpCapabilities()"),r.getLocalRtpCapabilities(e)),getNativeSctpCapabilities:async()=>(N.debug("getNativeSctpCapabilities()"),e.generateNativeSctpCapabilities())}}static getLocalRtpCapabilities(e){let t=e.generateNativeRtpCapabilities();return qr.validateAndNormalizeRtpCapabilities(t),t}constructor({getSendExtendedRtpCapabilities:e},t){super(),N.debug("constructor()"),this._getSendExtendedRtpCapabilities=e,this._fakeParameters=t}get name(){return Si}close(){N.debug("close()"),!this._closed&&(this._closed=!0,super.close())}setIceGatheringState(e){this.emit("@icegatheringstatechange",e)}setConnectionState(e){this.emit("@connectionstatechange",e)}async updateIceServers(e){this.assertNotClosed(),N.debug("updateIceServers()")}async restartIce(e){this.assertNotClosed(),N.debug("restartIce()")}async getTransportStats(){return this.assertNotClosed(),new Map}async send({track:e,streamId:t,encodings:s,codecOptions:i,codec:n}){this.assertNotClosed(),N.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"});let a=r.getLocalRtpCapabilities(this._fakeParameters),c=this._getSendExtendedRtpCapabilities(a),p=qr.getSendingRtpParameters(e.kind,c);p.codecs=qr.reduceCodecs(p.codecs,n);let l=p.codecs.some(d=>/.+\/rtx$/i.test(d.mimeType));p.mid=`mid-${Ke.generateRandomNumber()}`,p.msid=`${t??"-"} ${e.id}`,s||(s=[{}]);for(let d of s)d.ssrc=Ke.generateRandomNumber(),l&&(d.rtx={ssrc:Ke.generateRandomNumber()});p.encodings=s,p.rtcp={cname:this._cname,reducedSize:!0,mux:!0},p.msid=`${t??this._defaultSendStreamId} ${e.id}`;let o=this._nextLocalId++;return this._tracks.set(o,e),{localId:String(o),rtpParameters:p}}async stopSending(e){if(N.debug("stopSending() [localId:%s]",e),!this._closed){if(!this._tracks.has(Number(e)))throw new Error("local track not found");this._tracks.delete(Number(e))}}async pauseSending(e){this.assertNotClosed()}async resumeSending(e){this.assertNotClosed()}async replaceTrack(e,t){this.assertNotClosed(),t?N.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):N.debug("replaceTrack() [localId:%s, no track]",e),this._tracks.delete(Number(e)),this._tracks.set(Number(e),t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),N.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),N.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t)}async getSenderStats(e){return this.assertNotClosed(),new Map}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:i,protocol:n}){this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),N.debug("sendDataChannel()");let a=new Gt({id:this._nextSctpStreamId++,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:i,protocol:n}),c={streamId:this._nextSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s};return{dataChannel:a,sctpStreamParameters:c}}async receive(e){this.assertNotClosed();let t=[];for(let s of e){let{trackId:i,kind:n}=s;this._transportReady||await this.setupTransport({localDtlsRole:"client"}),N.debug("receive() [trackId:%s, kind:%s]",i,n);let a=this._nextLocalId++,c=new _o.FakeMediaStreamTrack({kind:n});this._tracks.set(a,c),t.push({localId:String(a),track:c})}return t}async stopReceiving(e){if(!this._closed)for(let t of e)N.debug("stopReceiving() [localId:%s]",t),this._tracks.delete(Number(t))}async pauseReceiving(e){this.assertNotClosed()}async resumeReceiving(e){this.assertNotClosed()}async getReceiverStats(e){return this.assertNotClosed(),new Map}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){return this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"client"}),N.debug("receiveDataChannel()"),{dataChannel:new Gt({id:e.streamId,ordered:e.ordered,maxPacketLifeTime:e.maxPacketLifeTime,maxRetransmits:e.maxRetransmits,label:t,protocol:s})}}async setupTransport({localDtlsRole:e,localSdpObject:t}){let s=Ke.clone(this._fakeParameters.generateLocalDtlsParameters());e&&(s.role=e),this.emit("@connectionstatechange","connecting"),await new Promise((i,n)=>this.emit("@connect",{dtlsParameters:s},i,n)),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new Ri.InvalidStateError("method called in a closed handler")}};Qt.FakeHandler=zr;var Gt=class extends bo.FakeEventTarget{_id;_negotiated=!0;_ordered;_maxPacketLifeTime;_maxRetransmits;_label;_protocol;_readyState="connecting";_bufferedAmount=0;_bufferedAmountLowThreshold=0;_binaryType="arraybuffer";_onopen=null;_onclosing=null;_onclose=null;_onmessage=null;_onbufferedamountlow=null;_onerror=null;constructor({id:e,ordered:t=!0,maxPacketLifeTime:s=null,maxRetransmits:i=null,label:n="",protocol:a=""}){super(),N.debug(`constructor() [id:${e}, ordered:${t}, maxPacketLifeTime:${s}, maxRetransmits:${i}, label:${n}, protocol:${a}`),this._id=e,this._ordered=t,this._maxPacketLifeTime=s,this._maxRetransmits=i,this._label=n,this._protocol=a}get id(){return this._id}get negotiated(){return this._negotiated}get ordered(){return this._ordered}get maxPacketLifeTime(){return this._maxPacketLifeTime}get maxRetransmits(){return this._maxRetransmits}get label(){return this._label}get protocol(){return this._protocol}get readyState(){return this._readyState}get bufferedAmount(){return this._bufferedAmount}get bufferedAmountLowThreshold(){return this._bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._bufferedAmountLowThreshold=e}get binaryType(){return this._binaryType}set binaryType(e){this._binaryType=e}get onopen(){return this._onopen}set onopen(e){this._onopen&&this.removeEventListener("open",this._onopen),this._onopen=e,e&&this.addEventListener("open",e)}get onclosing(){return this._onclosing}set onclosing(e){this._onclosing&&this.removeEventListener("closing",this._onclosing),this._onclosing=e,e&&this.addEventListener("closing",e)}get onclose(){return this._onclose}set onclose(e){this._onclose&&this.removeEventListener("close",this._onclose),this._onclose=e,e&&this.addEventListener("close",e)}get onmessage(){return this._onmessage}set onmessage(e){this._onmessage&&this.removeEventListener("message",this._onmessage),this._onmessage=e,e&&this.addEventListener("message",e)}get onbufferedamountlow(){return this._onbufferedamountlow}set onbufferedamountlow(e){this._onbufferedamountlow&&this.removeEventListener("bufferedamountlow",this._onbufferedamountlow),this._onbufferedamountlow=e,e&&this.addEventListener("bufferedamountlow",e)}get onerror(){return this._onerror}set onerror(e){this._onerror&&this.removeEventListener("error",this._onerror),this._onerror=e,e&&this.addEventListener("error",e)}addEventListener(e,t,s){super.addEventListener(e,t,s)}removeEventListener(e,t,s){super.removeEventListener(e,t,s)}close(){["closing","closed"].includes(this._readyState)||(this._readyState="closed")}send(e){if(this._readyState!=="open")throw new Ri.InvalidStateError("not open")}}});var Ti=y(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});te.generateRouterRtpCapabilities=yo;te.generateNativeRtpCapabilities=Co;te.generateNativeSctpCapabilities=So;te.generateLocalDtlsParameters=Ro;te.generateTransportRemoteParameters=Eo;te.generateProducerRemoteParameters=To;te.generateConsumerRemoteParameters=xo;te.generateDataProducerRemoteParameters=ko;te.generateDataConsumerRemoteParameters=Do;var q=ve();function H(){return String(q.generateRandomNumber())}function yo(){return q.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}},{mimeType:"video/H264",kind:"video",preferredPayloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:105,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"profile-id":0,"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:106,clockRate:9e4,rtcpFeedback:[],parameters:{apt:105}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id",preferredId:2,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id",preferredId:3,preferredEncrypt:!1,direction:"recvonly"},{kind:"audio",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:11,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:12,preferredEncrypt:!1,direction:"sendrecv"}]})}function Co(){return{codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:111,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{minptime:10,useinbandfec:1}},{mimeType:"audio/ISAC",kind:"audio",preferredPayloadType:103,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/CN",kind:"audio",preferredPayloadType:106,clockRate:32e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/foo",kind:"audio",preferredPayloadType:107,clockRate:9e4,channels:4,rtcpFeedback:[{type:"foo-qwe-qwe"}],parameters:{foo:"lalala"}},{mimeType:"video/BAZCODEC",kind:"video",preferredPayloadType:100,clockRate:9e4,rtcpFeedback:[{type:"foo"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[],parameters:{apt:100}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:96,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:97,clockRate:9e4,rtcpFeedback:[],parameters:{apt:96}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:98,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{"profile-id":0}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:99,clockRate:9e4,rtcpFeedback:[],parameters:{apt:98}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:2},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:3},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:4},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay",preferredId:6},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type",preferredId:7},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing",preferredId:8},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10}]}}function So(){return q.deepFreeze({numStreams:{OS:2048,MIS:2048}})}function Ro(){return q.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"82:5A:68:3D:36:C3:0A:DE:AF:E7:32:43:D2:88:83:57:AC:2D:65:E5:80:C4:B6:FB:AF:1A:A0:21:9F:6D:0C:AD"}],role:"auto"})}function Eo(){return{id:H(),iceParameters:q.deepFreeze({iceLite:!0,password:"yku5ej8nvfaor28lvtrabcx0wkrpkztz",usernameFragment:"h3hk1iz6qqlnqlne"}),iceCandidates:q.deepFreeze([{foundation:"udpcandidate",address:"9.9.9.9",ip:"9.9.9.9",port:40533,priority:1078862079,protocol:"udp",type:"host",tcpType:"passive"},{foundation:"udpcandidate",address:"9.9.9.9",ip:"9:9:9:9:9:9",port:41333,priority:1078862089,protocol:"udp",type:"host",tcpType:"passive"}]),dtlsParameters:q.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"A9:F4:E0:D2:74:D3:0F:D9:CA:A5:2F:9F:7F:47:FA:F0:C4:72:DD:73:49:D0:3B:14:90:20:51:30:1B:90:8E:71"},{algorithm:"sha-384",value:"03:D9:0B:87:13:98:F6:6D:BC:FC:92:2E:39:D4:E1:97:32:61:30:56:84:70:81:6E:D1:82:97:EA:D9:C1:21:0F:6B:C5:E7:7F:E1:97:0C:17:97:6E:CF:B3:EF:2E:74:B0"},{algorithm:"sha-512",value:"84:27:A4:28:A4:73:AF:43:02:2A:44:68:FF:2F:29:5C:3B:11:9A:60:F4:A8:F0:F5:AC:A0:E3:49:3E:B1:34:53:A9:85:CE:51:9B:ED:87:5E:B8:F4:8E:3D:FA:20:51:B8:96:EE:DA:56:DC:2F:5C:62:79:15:23:E0:21:82:2B:2C"}],role:"auto"}),sctpParameters:q.deepFreeze({port:5e3,OS:2048,MIS:2048,maxMessageSize:2e6})}}function To(){return q.deepFreeze({id:H()})}function xo({id:r,codecMimeType:e}={}){switch(e){case"audio/opus":return{id:r??H(),producerId:H(),kind:"audio",rtpParameters:q.deepFreeze({codecs:[{mimeType:"audio/opus",payloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}}],encodings:[{ssrc:46687003}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",id:10}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"audio/ISAC":return{id:r??H(),producerId:H(),kind:"audio",rtpParameters:q.deepFreeze({codecs:[{mimeType:"audio/ISAC",payloadType:111,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}}],encodings:[{ssrc:46687004}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/VP8":return{id:r??H(),producerId:H(),kind:"video",rtpParameters:q.deepFreeze({codecs:[{mimeType:"video/VP8",payloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",payloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}}],encodings:[{ssrc:99991111,rtx:{ssrc:99991112}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/H264":return{id:r??H(),producerId:H(),kind:"video",rtpParameters:q.deepFreeze({codecs:[{mimeType:"video/H264",payloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",payloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}}],encodings:[{ssrc:99991113,rtx:{ssrc:99991114}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};default:throw new TypeError(`unknown codecMimeType '${e}'`)}}function ko(){return q.deepFreeze({id:H()})}function Do({id:r}={}){return{id:r??H(),dataProducerId:H(),sctpStreamParameters:q.deepFreeze({streamId:666,maxPacketLifeTime:5e3,maxRetransmits:void 0})}}});var Mo=y(M=>{Object.defineProperty(M,"__esModule",{value:!0});M.debug=M.testFakeParameters=M.FakeHandler=M.enhancedEvents=M.ortc=M.parseScalabilityMode=M.detectDeviceAsync=M.detectDevice=M.Device=M.version=M.types=void 0;var Po=Kt();M.debug=Po.default;M.types=Gr();M.version="3.18.3";var $r=fi();Object.defineProperty(M,"Device",{enumerable:!0,get:function(){return $r.Device}});Object.defineProperty(M,"detectDevice",{enumerable:!0,get:function(){return $r.detectDevice}});Object.defineProperty(M,"detectDeviceAsync",{enumerable:!0,get:function(){return $r.detectDeviceAsync}});var Lo=Ce();Object.defineProperty(M,"parseScalabilityMode",{enumerable:!0,get:function(){return Lo.parse}});M.ortc=se();M.enhancedEvents=$();var Io=Ei();Object.defineProperty(M,"FakeHandler",{enumerable:!0,get:function(){return Io.FakeHandler}});M.testFakeParameters=Ti()});return Mo();})();
